{% sw_extends '@Storefront/storefront/layout/footer/footer.html.twig' %}

{% block layout_footer_inner_container %}
<footer class="raven-footer">
    {# Feature Highlights Strip #}
    <div class="footer-features" style="background: #ffffff; border-top: 1px solid #e5e7eb;">
        <div class="max-w-7xl mx-auto px-6 lg:px-24 py-6">
            <div class="features-grid" style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1rem;">
                {# Swiss Quality #}
                <div class="feature-card" style="display: flex; align-items: center; gap: 1rem; padding: 1rem 1.25rem; border-radius: 12px; border: 1px solid #e5e7eb; background: white; transition: all 0.3s ease;">
                    <span style="display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #dc2626, #b91c1c); flex-shrink: 0; overflow: hidden;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" style="width: 100%; height: 100%;">
                            <rect width="32" height="32" fill="#dc2626"/>
                            <path d="M13 6h6v7h7v6h-7v7h-6v-7H6v-6h7V6z" fill="white"/>
                        </svg>
                    </span>
                    <div>
                        <div style="font-family: 'Inter', sans-serif; font-weight: 600; color: #111827; font-size: 0.9375rem;">Schweizer Qualität</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 0.8125rem; color: #6b7280;">Familienbetrieb seit Jahren</div>
                    </div>
                </div>

                {# Best Prices #}
                <div class="feature-card" style="display: flex; align-items: center; gap: 1rem; padding: 1rem 1.25rem; border-radius: 12px; border: 1px solid #e5e7eb; background: white; transition: all 0.3s ease;">
                    <span style="display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #F2B90D, #F6CE55); flex-shrink: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#1f2937" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </span>
                    <div>
                        <div style="font-family: 'Inter', sans-serif; font-weight: 600; color: #111827; font-size: 0.9375rem;">Beste Preise</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 0.8125rem; color: #6b7280;">Direktverkauf = faire Preise</div>
                    </div>
                </div>

                {# Fast Shipping #}
                <div class="feature-card" style="display: flex; align-items: center; gap: 1rem; padding: 1rem 1.25rem; border-radius: 12px; border: 1px solid #e5e7eb; background: white; transition: all 0.3s ease;">
                    <span style="display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #111827, #374151); flex-shrink: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="1" y="3" width="15" height="13"></rect>
                            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                            <circle cx="5.5" cy="18.5" r="2.5"></circle>
                            <circle cx="18.5" cy="18.5" r="2.5"></circle>
                        </svg>
                    </span>
                    <div>
                        <div style="font-family: 'Inter', sans-serif; font-weight: 600; color: #111827; font-size: 0.9375rem;">Schneller Versand</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 0.8125rem; color: #6b7280;">Mo–Fr bis 19:20 Uhr bestellt</div>
                    </div>
                </div>

                {# Phone Support #}
                <div class="feature-card" style="display: flex; align-items: center; gap: 1rem; padding: 1rem 1.25rem; border-radius: 12px; border: 1px solid #e5e7eb; background: white; transition: all 0.3s ease;">
                    <span style="display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #22c55e, #16a34a); flex-shrink: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                    </span>
                    <div>
                        <div style="font-family: 'Inter', sans-serif; font-weight: 600; color: #111827; font-size: 0.9375rem;">+41 79 356 19 86</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 0.8125rem; color: #6b7280;">Freundlich & kompetent</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# Newsletter Section #}
    <div class="newsletter-section" style="background: linear-gradient(135deg, #F2B90D 0%, #F6CE55 50%, #FFD54F 100%); position: relative; overflow: hidden;">
        {# Decorative pattern #}
        <div style="position: absolute; inset: 0; opacity: 0.1; background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23000000\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>

        <div class="max-w-7xl mx-auto px-6 lg:px-24 py-8 relative z-10">
            <div class="newsletter-content" style="display: flex; flex-direction: column; gap: 1.5rem; align-items: center; text-align: center;">
                <div style="display: flex; flex-direction: column; gap: 0.5rem; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span style="display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; border-radius: 10px; background: rgba(0,0,0,0.15);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#1f2937" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                        </span>
                        <h3 style="font-family: 'Chakra Petch', sans-serif; font-size: 1.75rem; font-weight: 700; color: #1f2937; margin: 0;">Newsletter</h3>
                    </div>
                    <p style="font-family: 'Inter', sans-serif; font-size: 1rem; color: rgba(31, 41, 55, 0.8); margin: 0;">Exklusive Angebote & Neuheiten direkt in Ihr Postfach</p>
                </div>

                <form class="newsletter-form" style="display: flex; flex-direction: column; gap: 0.75rem; width: 100%; max-width: 500px;">
                    <div style="display: flex; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 14px rgba(0, 0, 0, 0.1);">
                        <input type="email" placeholder="Ihre E-Mail-Adresse" style="flex: 1; padding: 1rem 1.25rem; border: none; font-family: 'Inter', sans-serif; font-size: 0.9375rem; outline: none; min-width: 0;">
                        <button type="submit" style="padding: 1rem 1.5rem; background: #1f2937; color: white; border: none; font-family: 'Inter', sans-serif; font-weight: 600; font-size: 0.9375rem; cursor: pointer; transition: background 0.2s ease; white-space: nowrap;">
                            Abonnieren
                        </button>
                    </div>
                    <p style="font-family: 'Inter', sans-serif; font-size: 0.75rem; color: rgba(31, 41, 55, 0.6); margin: 0;">Mit der Anmeldung akzeptieren Sie unsere Datenschutzerklärung</p>
                </form>
            </div>
        </div>
    </div>

    {# Main Footer Content #}
    <div class="footer-main" style="background: #111827; color: white;">
        <div class="max-w-7xl mx-auto px-6 lg:px-24 py-12">
            <div class="footer-grid" style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 3rem;">
                {# Brand Column #}
                <div class="footer-brand">
                    <a href="{{ path('frontend.home.page') }}" style="display: inline-block; margin-bottom: 1.25rem;">
                        {# Raven Logo - White version for dark background #}
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 50" style="height: 40px; width: auto;">
                            <g fill="white">
                                <path d="M25 5c-11 0-20 9-20 20s9 20 20 20c3.5 0 6.8-.9 9.7-2.5L25 30l-5 12.5C11.5 42.5 5 36 5 25S15 5 25 5z"/>
                                <path d="M35 15l-10 15 9.7 12.5c5.5-3.5 9.3-9.5 9.3-17.5 0-4-1.2-7.8-3.3-11L35 15z"/>
                            </g>
                            <text x="55" y="22" fill="white" font-family="'Chakra Petch', sans-serif" font-size="18" font-weight="700">RAVEN</text>
                            <text x="55" y="38" fill="white" font-family="'Chakra Petch', sans-serif" font-size="12" font-weight="400" letter-spacing="3">WEAPON</text>
                        </svg>
                    </a>
                    <p style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.7); line-height: 1.6; margin-bottom: 1.5rem; max-width: 280px;">
                        Schweizer Qualität trifft auf kanadische Handwerkskunst. Ihre erste Adresse für Präzisionswaffen.
                    </p>

                    {# Social Links #}
                    <div style="display: flex; gap: 0.75rem;">
                        <a href="https://instagram.com/ravenweapon" target="_blank" rel="noopener" style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; transition: all 0.2s ease;" aria-label="Instagram">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                            </svg>
                        </a>
                        <a href="https://youtube.com/@ravenweapon" target="_blank" rel="noopener" style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; transition: all 0.2s ease;" aria-label="YouTube">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path>
                                <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
                            </svg>
                        </a>
                        <a href="https://wa.me/41793561986" target="_blank" rel="noopener" style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 10px; background: rgba(255,255,255,0.1); color: white; transition: all 0.2s ease;" aria-label="WhatsApp">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                            </svg>
                        </a>
                    </div>
                </div>

                {# Company Column #}
                <div>
                    <h4 style="font-family: 'Inter', sans-serif; font-size: 0.75rem; font-weight: 600; color: #F2B90D; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 1.25rem;">Kontakt</h4>
                    <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.75rem;">
                        <li style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8);">Raven Weapon AG</li>
                        <li style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8);">Sunnenbergstrasse 2</li>
                        <li style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8);">8633 Wolfhausen</li>
                        <li style="margin-top: 0.5rem;">
                            <a href="mailto:info@ravenweapon.ch" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">info@ravenweapon.ch</a>
                        </li>
                        <li>
                            <a href="tel:+41793561986" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">+41 79 356 19 86</a>
                        </li>
                    </ul>
                </div>

                {# Links Column #}
                <div>
                    <h4 style="font-family: 'Inter', sans-serif; font-size: 0.75rem; font-weight: 600; color: #F2B90D; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 1.25rem;">Informationen</h4>
                    <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.75rem;">
                        <li><a href="{{ path('frontend.cms.page', { id: 'contact' }) }}" class="footer-link" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">Kontakt</a></li>
                        <li><a href="#versand" class="footer-link" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">Versand & Lieferung</a></li>
                        <li><a href="#faq" class="footer-link" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">FAQ</a></li>
                        <li><a href="#agb" class="footer-link" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">AGB</a></li>
                        <li><a href="#impressum" class="footer-link" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">Impressum</a></li>
                        <li><a href="#datenschutz" class="footer-link" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">Datenschutz</a></li>
                    </ul>
                </div>

                {# Categories Column #}
                <div>
                    <h4 style="font-family: 'Inter', sans-serif; font-size: 0.75rem; font-weight: 600; color: #F2B90D; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 1.25rem;">Kategorien</h4>
                    <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.75rem;">
                        {% for treeItem in page.header.navigation.tree %}
                            <li>
                                <a href="{{ seoUrl('frontend.navigation.page', { navigationId: treeItem.category.id }) }}" class="footer-link" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">
                                    {{ treeItem.category.translated.name }}
                                </a>
                            </li>
                        {% endfor %}
                        <li>
                            <a href="{{ path('frontend.cms.page', { id: 'about-us' }) }}" class="footer-link" style="font-family: 'Inter', sans-serif; font-size: 0.9375rem; color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.2s;">
                                Über uns
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        {# Copyright Bar #}
        <div style="border-top: 1px solid rgba(255,255,255,0.1);">
            <div class="max-w-7xl mx-auto px-6 lg:px-24 py-6">
                <div style="display: flex; flex-direction: column; gap: 1rem; align-items: center; text-align: center;">
                    <p style="font-family: 'Inter', sans-serif; font-size: 0.875rem; color: rgba(255,255,255,0.5); margin: 0;">
                        &copy; {{ "now"|date("Y") }} RAVEN WEAPON AG. Alle Rechte vorbehalten.
                    </p>
                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; justify-content: center;">
                        <img src="{{ asset('bundles/raventheme/assets/visa.svg', 'asset') }}" alt="Visa" style="height: 24px; opacity: 0.6;" onerror="this.style.display='none'">
                        <img src="{{ asset('bundles/raventheme/assets/mastercard.svg', 'asset') }}" alt="Mastercard" style="height: 24px; opacity: 0.6;" onerror="this.style.display='none'">
                        <img src="{{ asset('bundles/raventheme/assets/twint.svg', 'asset') }}" alt="Twint" style="height: 24px; opacity: 0.6;" onerror="this.style.display='none'">
                        <span style="font-family: 'Inter', sans-serif; font-size: 0.75rem; color: rgba(255,255,255,0.4);">Sichere Zahlung</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

<style>
/* Responsive footer grid */
@media (min-width: 640px) {
    .features-grid { grid-template-columns: repeat(2, 1fr) !important; }
    .footer-grid { grid-template-columns: repeat(2, 1fr) !important; }
    .newsletter-content { flex-direction: row !important; text-align: left !important; justify-content: space-between !important; }
    .newsletter-content > div:first-child { align-items: flex-start !important; }
    .newsletter-form { max-width: none !important; width: auto !important; }
    .newsletter-form > div { flex-direction: row !important; }
}

@media (min-width: 1024px) {
    .features-grid { grid-template-columns: repeat(4, 1fr) !important; }
    .footer-grid { grid-template-columns: 1.5fr 1fr 1fr 1fr !important; }
}

/* Feature card hover */
.feature-card:hover {
    border-color: #F2B90D;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
}

/* Footer link hover */
.footer-link:hover {
    color: #F2B90D !important;
}

/* Social icon hover */
.footer-main a[aria-label]:hover {
    background: linear-gradient(135deg, #F2B90D 0%, #F6CE55 100%) !important;
    color: #1f2937 !important;
}

/* Newsletter button hover */
.newsletter-form button:hover {
    background: #374151 !important;
}
</style>

{# Cart JS via SVG onload - bypasses Shopware script stripping #}
<svg onload="(function(){function c(){fetch('/checkout/offcanvas',{method:'GET',headers:{'X-Requested-With':'XMLHttpRequest'}}).then(function(r){return r.text()}).then(function(h){var o=document.getElementById('raven-offcanvas-cart');if(!o){o=document.createElement('div');o.id='raven-offcanvas-cart';o.style.cssText='position:fixed;top:0;right:0;bottom:0;width:420px;max-width:100vw;z-index:1050;background:#fff;transform:translateX(100%);transition:transform 0.3s ease;box-shadow:-4px 0 15px rgba(0,0,0,0.1);';document.body.appendChild(o)}o.innerHTML=h;o.style.transform='translateX(0)';var b=document.getElementById('raven-offcanvas-backdrop');if(!b){b=document.createElement('div');b.id='raven-offcanvas-backdrop';b.style.cssText='position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1040;opacity:0;transition:opacity 0.15s;';b.onclick=d;document.body.appendChild(b)}setTimeout(function(){b.style.opacity='1'},10);document.body.style.overflow='hidden';o.querySelectorAll('[data-offcanvas-close],.raven-cart-close').forEach(function(x){x.onclick=d});if(window.PluginManager)window.PluginManager.initializePlugins()})}function d(){var o=document.getElementById('raven-offcanvas-cart'),b=document.getElementById('raven-offcanvas-backdrop');if(o)o.style.transform='translateX(100%)';if(b){b.style.opacity='0';setTimeout(function(){b.remove()},150)}document.body.style.overflow=''}window.ravenOpenCart=c;window.ravenCloseCart=d;document.addEventListener('click',function(e){if(e.target.closest('[data-offcanvas-cart]')){e.preventDefault();c()}})})();" style="display:none!important;position:absolute;width:0;height:0;overflow:hidden;"></svg>

<script>
// Raven Theme - Off-Canvas Cart Handler (backup)
(function() {
    function ravenOpenCart() {
        fetch('/checkout/offcanvas', {
            method: 'GET',
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(function(response) { return response.text(); })
        .then(function(html) {
            var offcanvas = document.getElementById('raven-offcanvas-cart');
            if (!offcanvas) {
                offcanvas = document.createElement('div');
                offcanvas.id = 'raven-offcanvas-cart';
                offcanvas.className = 'offcanvas offcanvas-end';
                offcanvas.style.cssText = 'position:fixed;top:0;right:0;bottom:0;width:420px;max-width:100vw;z-index:1050;background:#fff;transform:translateX(100%);transition:transform 0.3s ease;box-shadow:-4px 0 15px rgba(0,0,0,0.1);';
                document.body.appendChild(offcanvas);
            }
            offcanvas.innerHTML = '<div class="offcanvas-body p-0">' + html + '</div>';
            offcanvas.style.transform = 'translateX(0)';
            offcanvas.classList.add('show');

            var backdrop = document.getElementById('raven-offcanvas-backdrop');
            if (!backdrop) {
                backdrop = document.createElement('div');
                backdrop.id = 'raven-offcanvas-backdrop';
                backdrop.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1040;opacity:0;transition:opacity 0.15s;';
                backdrop.onclick = ravenCloseCart;
                document.body.appendChild(backdrop);
            }
            setTimeout(function() { backdrop.style.opacity = '1'; }, 10);
            document.body.style.overflow = 'hidden';

            offcanvas.querySelectorAll('[data-offcanvas-close], .js-offcanvas-close, .raven-cart-close').forEach(function(btn) {
                btn.onclick = ravenCloseCart;
            });

            if (window.PluginManager) {
                window.PluginManager.initializePlugins();
            }
        });
    }

    function ravenCloseCart() {
        var offcanvas = document.getElementById('raven-offcanvas-cart');
        var backdrop = document.getElementById('raven-offcanvas-backdrop');
        if (offcanvas) {
            offcanvas.style.transform = 'translateX(100%)';
            offcanvas.classList.remove('show');
        }
        if (backdrop) {
            backdrop.style.opacity = '0';
            setTimeout(function() { backdrop.remove(); }, 150);
        }
        document.body.style.overflow = '';
    }

    window.ravenOpenCart = ravenOpenCart;
    window.ravenCloseCart = ravenCloseCart;

    function initCartHandlers() {
        document.querySelectorAll('[data-offcanvas-cart]').forEach(function(btn) {
            btn.removeEventListener('click', handleCartClick);
            btn.addEventListener('click', handleCartClick);
        });
    }

    function handleCartClick(e) {
        e.preventDefault();
        e.stopPropagation();
        ravenOpenCart();
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCartHandlers);
    } else {
        initCartHandlers();
    }

    document.addEventListener('click', function(e) {
        if (e.target.closest('[data-offcanvas-cart]')) {
            e.preventDefault();
            ravenOpenCart();
        }
    });
})();
</script>
{% endblock %}
