{% sw_extends '@Storefront/storefront/page/navigation/index.html.twig' %}

{% block base_main_inner %}
<main class="raven-category-page">
    {# Clean Header Section #}
    <section style="background: white; padding: 2rem 0 1rem;">
        <div class="max-w-7xl mx-auto px-6 lg:px-24">
            <div style="display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 1rem;">
                <h1 style="font-family: 'Chakra Petch', sans-serif; font-size: clamp(2rem, 4vw, 3rem); font-weight: 400; color: #111827; line-height: 1.1; margin: 0;">
                    {{ page.header.navigation.active.translated.name }}
                </h1>
                {% if page.listing.total is defined %}
                <span style="font-family: 'Inter', sans-serif; font-size: 0.875rem; color: #9ca3af;">
                    {{ page.listing.total }} {% if page.listing.total == 1 %}Produkt{% else %}Produkte{% endif %}
                </span>
                {% endif %}
            </div>
        </div>
    </section>

    {# Products Section #}
    <section class="products-section" style="background: white; padding: 1rem 0 4rem;">
        <div class="max-w-7xl mx-auto px-6 lg:px-24">

            {% if page.listing.elements|length > 0 %}
            {# Product Grid #}
            <div class="raven-product-grid" style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 2rem;">
                {% for product in page.listing.elements %}
                <article class="raven-product-card" style="background: white; cursor: pointer;">
                    <a href="{{ seoUrl('frontend.detail.page', { productId: product.id }) }}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="height: 18rem; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            {% if product.cover.media %}
                                <img class="product-img" src="{{ product.cover.media.url }}" alt="{{ product.translated.name }}" style="max-width: 100%; max-height: 100%; object-fit: contain; padding: 0.75rem;">
                            {% else %}
                                <div style="color: #d1d5db;">
                                    {% sw_icon 'placeholder' style { 'size': 'lg' } %}
                                </div>
                            {% endif %}
                        </div>
                    </a>
                    <div style="padding: 0.75rem 0 1rem;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 0.75rem;">
                            <div style="flex: 1;">
                                <div style="color: #E53935; font-weight: 600; font-size: 16px; line-height: 1.2;">
                                    {% if product.calculatedPrice %}
                                        {% set priceValue = product.calculatedPrice.unitPrice %}
                                        {% set cents = ((priceValue * 100) % 100)|round %}
                                        CHF {% if cents == 0 %}{{ priceValue|number_format(0, '.', '') }}.–{% else %}{{ priceValue|number_format(2, '.', '') }}{% endif %}
                                    {% endif %}
                                </div>
                                <div style="color: #374151; font-size: 1rem; margin-top: 0.25rem;">
                                    {{ product.translated.name }}
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; margin-top: -0.5rem;">
                                <span style="width: 20px; height: 20px; border-radius: 50%; background: {% if product.availableStock > 0 or product.isCloseout == false %}#77C15A{% else %}#ef4444{% endif %}; display: inline-flex; align-items: center; justify-content: center;" title="{% if product.availableStock > 0 or product.isCloseout == false %}Verfügbar{% else %}Nicht verfügbar{% endif %}">
                                    <svg viewBox="0 0 24 24" fill="none" style="width: 12px; height: 12px;"><path d="M5 13l4 4L19 7" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                </span>
                                <form action="{{ path('frontend.checkout.line-item.add') }}" method="post" data-form-csrf-handler="true">
                                    <input type="hidden" name="redirectTo" value="frontend.cart.offcanvas">
                                    <input type="hidden" name="lineItems[{{ product.id }}][id]" value="{{ product.id }}">
                                    <input type="hidden" name="lineItems[{{ product.id }}][quantity]" value="1">
                                    <input type="hidden" name="lineItems[{{ product.id }}][type]" value="product">
                                    <input type="hidden" name="lineItems[{{ product.id }}][referencedId]" value="{{ product.id }}">
                                    <input type="hidden" name="lineItems[{{ product.id }}][stackable]" value="1">
                                    <input type="hidden" name="lineItems[{{ product.id }}][removable]" value="1">
                                    <button type="submit" style="width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; background: transparent; border: none; color: #374151; cursor: pointer;" title="In den Warenkorb">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" style="width: 24px; height: 24px;"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </article>
                {% endfor %}
            </div>

            {# Pagination #}
            {% if page.listing.pages > 1 %}
            <div style="margin-top: 3rem; display: flex; justify-content: center;">
                {% sw_include '@Storefront/storefront/component/pagination.html.twig' with {
                    entities: page.listing,
                    criteria: page.listing.criteria
                } %}
            </div>
            {% endif %}

            {% else %}
            {# Empty State #}
            <div style="text-align: center; padding: 4rem 2rem;">
                <div style="width: 80px; height: 80px; margin: 0 auto 1.5rem; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #9ca3af;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </div>
                <h3 style="font-family: 'Chakra Petch', sans-serif; font-size: 1.5rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem;">Keine Produkte gefunden</h3>
                <p style="font-family: 'Inter', sans-serif; color: #6b7280; margin-bottom: 2rem;">In dieser Kategorie sind noch keine Produkte vorhanden.</p>
                <a href="{{ path('frontend.home.page') }}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); color: #1f2937; font-weight: 600; border-radius: 0.5rem; text-decoration: none; border: 1px solid #C59A0F;">
                    Zur Startseite
                </a>
            </div>
            {% endif %}
        </div>
    </section>
</main>

<style>
@media (min-width: 640px) { .raven-product-grid { grid-template-columns: repeat(2, 1fr) !important; } }
@media (min-width: 768px) { .raven-product-grid { grid-template-columns: repeat(3, 1fr) !important; } }

.raven-product-card {
    transition: all 0.3s ease;
    position: relative;
    background: white !important;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    overflow: visible !important;
}
.raven-product-card:hover .product-img { transform: scale(1.05); }
.product-img { transition: transform 0.3s ease; }

/* Vertical gold divider between products */
.raven-product-card::after {
    content: '' !important;
    position: absolute !important;
    right: -1rem !important;
    top: 0 !important;
    height: 100% !important;
    width: 2px !important;
    background: #D4A847 !important;
    display: block !important;
}
@media (min-width: 768px) {
    .raven-product-card:nth-child(3n)::after { display: none !important; }
}
@media (min-width: 640px) and (max-width: 767px) {
    .raven-product-card:nth-child(2n)::after { display: none !important; }
}
@media (max-width: 639px) {
    .raven-product-card::after { display: none !important; }
}
</style>
{% endblock %}
