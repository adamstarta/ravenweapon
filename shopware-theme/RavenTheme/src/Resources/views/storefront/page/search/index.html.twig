{% sw_extends '@Storefront/storefront/page/search/index.html.twig' %}

{% block base_main_inner %}
<main class="raven-all-products-page">
    {# Hero Banner #}
    <section class="all-products-hero" style="background: #1a1a1a; padding: 3rem 0 4rem; position: relative; overflow: hidden;">

        <div class="max-w-7xl mx-auto px-6 lg:px-24 relative z-10">
            {# Breadcrumb #}
            <nav class="breadcrumb" style="margin-bottom: 1.5rem;" aria-label="Breadcrumb">
                <div style="display: flex; align-items: center; gap: 0.5rem; font-family: 'Inter', sans-serif; font-size: 0.875rem;">
                    <a href="{{ path('frontend.home.page') }}" style="color: rgba(255,255,255,0.6); text-decoration: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                    </a>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                    <span style="color: #F2B90D; font-weight: 500;">{% if page.searchTerm %}{{ page.searchTerm }}{% else %}Alle Produkte{% endif %}</span>
                </div>
            </nav>

            {# Title #}
            <h1 style="font-family: 'Chakra Petch', sans-serif; font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 700; color: white; line-height: 1.1; margin: 0;">
                {% if page.searchTerm %}
                    {{ page.searchTerm }}
                {% else %}
                    Alle Produkte
                {% endif %}
            </h1>

            {% if page.listing.total is defined %}
            <p style="font-family: 'Inter', sans-serif; font-size: 1.125rem; color: rgba(255,255,255,0.7); margin-top: 1rem;">
                <span style="color: #F2B90D; font-weight: 600;">{{ page.listing.total }}</span> {% if page.listing.total == 1 %}Produkt{% else %}Produkte{% endif %} gefunden
            </p>
            {% endif %}
        </div>
    </section>

{# Filters removed - clean search page #}

    {# Products Section #}
    <section class="products-section" style="background: #f9fafb; padding: 3rem 0 5rem;">
        <div class="max-w-7xl mx-auto px-6 lg:px-24">

            {% if page.listing.elements|length > 0 %}
            {# Product Grid #}
            <div class="product-grid" style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1.5rem;">
                {% for product in page.listing.elements %}
                <article class="raven-product-card" style="background: white; cursor: pointer;">
                    <a href="{{ seoUrl('frontend.detail.page', { productId: product.id }) }}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="height: 18rem; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            {% if product.cover.media %}
                                <img class="product-img" src="{{ product.cover.media.url }}" alt="{{ product.translated.name }}" style="max-width: 100%; max-height: 100%; object-fit: contain; padding: 0.75rem;">
                            {% else %}
                                <div style="color: #d1d5db;">
                                    {% sw_icon 'placeholder' style { 'size': 'lg' } %}
                                </div>
                            {% endif %}
                        </div>
                    </a>
                    <div style="padding: 0.75rem 1.5rem 1rem;">
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 0.75rem;">
                            <div style="flex: 1;">
                                <div style="color: #E53935; font-weight: 600; font-size: 16px; line-height: 1.2;">
                                    {% if product.calculatedPrice %}
                                        CHF {{ product.calculatedPrice.unitPrice|number_format(2, '.', "'") }}
                                    {% endif %}
                                </div>
                                {# Star Ratings - Use ratingAverage which is available in listings #}
                                {% if product.ratingAverage and product.ratingAverage > 0 %}
                                    {% set rating = product.ratingAverage|round %}
                                    <div style="display: flex; align-items: center; gap: 6px; margin-top: 4px;">
                                        <div style="display: flex; gap: 2px;">
                                            {% for i in 1..5 %}
                                                {% if rating >= i %}
                                                    <svg style="width: 14px; height: 14px; color: #D4A847;" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                                                {% else %}
                                                    <svg style="width: 14px; height: 14px; color: #D1D5DB;" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <span style="font-size: 0.75rem; color: #6b7280;">({{ product.ratingAverage|number_format(1) }})</span>
                                    </div>
                                {% endif %}
                                <div style="color: #374151; font-size: 1rem; margin-top: 0.25rem;">
                                    <div style="font-weight: 700;">{{ product.manufacturer.translated.name|default('') }}</div>
                                    <a href="{{ seoUrl('frontend.detail.page', { productId: product.id }) }}" style="color: inherit; text-decoration: none;">{{ product.translated.name }}</a>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; margin-top: -0.5rem;">
                                <span style="width: 20px; height: 20px; border-radius: 50%; background: {% if product.availableStock > 0 or product.isCloseout == false %}linear-gradient(135deg, #22c55e 0%, #16a34a 100%){% else %}linear-gradient(135deg, #ef4444 0%, #dc2626 100%){% endif %}; display: inline-flex; align-items: center; justify-content: center;" title="{% if product.availableStock > 0 or product.isCloseout == false %}Verfügbar{% else %}Nicht verfügbar{% endif %}">
                                    <svg viewBox="0 0 24 24" fill="none" style="width: 12px; height: 12px;">{% if product.availableStock > 0 or product.isCloseout == false %}<path d="M5 13l4 4L19 7" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>{% else %}<path d="M6 18L18 6M6 6l12 12" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>{% endif %}</svg>
                                </span>
                                <form action="{{ path('frontend.checkout.line-item.add') }}" method="post" data-form-csrf-handler="true">
                                    <input type="hidden" name="redirectTo" value="frontend.cart.offcanvas">
                                    <input type="hidden" name="lineItems[{{ product.id }}][id]" value="{{ product.id }}">
                                    <input type="hidden" name="lineItems[{{ product.id }}][quantity]" value="1">
                                    <input type="hidden" name="lineItems[{{ product.id }}][type]" value="product">
                                    <input type="hidden" name="lineItems[{{ product.id }}][referencedId]" value="{{ product.id }}">
                                    <input type="hidden" name="lineItems[{{ product.id }}][stackable]" value="1">
                                    <input type="hidden" name="lineItems[{{ product.id }}][removable]" value="1">
                                    <button type="submit" style="width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; background: transparent; border: none; color: #374151; cursor: pointer;" title="In den Warenkorb">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" style="width: 24px; height: 24px;"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </article>
                {% endfor %}
            </div>

            {# Bottom Pagination #}
            {% if totalPages > 1 %}
            <div class="pagination-wrapper" style="margin-top: 3rem; display: flex; justify-content: center;">
                <nav class="pagination-nav" aria-label="Pagination" style="display: flex; align-items: center; gap: 0.25rem; background: white; padding: 0.5rem 1rem; border-radius: 12px; border: 1px solid #e5e7eb;">
                    {# Previous Page #}
                    {% if currentPage > 1 %}
                    <a href="?search={{ page.searchTerm|default('') }}&p={{ currentPage - 1 }}" style="display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 6px; color: #374151; text-decoration: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                    </a>
                    {% endif %}

                    {# Page Numbers #}
                    {% for i in 1..totalPages %}
                        {% if i == currentPage %}
                        <span style="display: flex; align-items: center; justify-content: center; min-width: 32px; height: 32px; padding: 0 8px; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); color: #1f2937; border-radius: 6px; font-size: 0.875rem; font-weight: 600; border: 1px solid #C59A0F;">{{ i }}</span>
                        {% elseif i <= 5 or i > totalPages - 2 or (i >= currentPage - 1 and i <= currentPage + 1) %}
                        <a href="?search={{ page.searchTerm|default('') }}&p={{ i }}" style="display: flex; align-items: center; justify-content: center; min-width: 32px; height: 32px; padding: 0 8px; color: #374151; text-decoration: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500;">{{ i }}</a>
                        {% elseif i == 6 or i == totalPages - 2 %}
                        <span style="padding: 0 4px; color: #9ca3af;">...</span>
                        {% endif %}
                    {% endfor %}

                    {# Next Page #}
                    {% if currentPage < totalPages %}
                    <a href="?search={{ page.searchTerm|default('') }}&p={{ currentPage + 1 }}" style="display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 6px; color: #374151; text-decoration: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                    </a>
                    {% endif %}
                </nav>
            </div>
            {% endif %}

            {% else %}
            {# Empty State #}
            <div class="empty-state" style="text-align: center; padding: 5rem 2rem; background: white; border-radius: 20px; border: 1px solid #e5e7eb;">
                <div style="width: 80px; height: 80px; margin: 0 auto 1.5rem; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #9ca3af;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </div>
                <h3 style="font-family: 'Chakra Petch', sans-serif; font-size: 1.5rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem;">Keine Produkte gefunden</h3>
                <p style="font-family: 'Inter', sans-serif; color: #6b7280; margin-bottom: 2rem;">Versuchen Sie es mit anderen Suchbegriffen.</p>
                <a href="{{ path('frontend.home.page') }}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.875rem 1.5rem; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); color: #1f2937; font-weight: 600; border-radius: 0.5rem; text-decoration: none; border: 1px solid #C59A0F;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    Zur Startseite
                </a>
            </div>
            {% endif %}
        </div>
    </section>
</main>


<style>
@media (min-width: 640px) { .product-grid { grid-template-columns: repeat(2, 1fr) !important; } }
@media (min-width: 768px) { .product-grid { grid-template-columns: repeat(4, 1fr) !important; } }

.raven-product-card {
    transition: all 0.3s ease;
    position: relative;
    background: white !important;
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    overflow: visible !important;
}
.raven-product-card:hover .product-img { transform: scale(1.05); }
.product-img { transition: transform 0.3s ease; }
</style>

{# Filters JS removed #}
{% endblock %}
