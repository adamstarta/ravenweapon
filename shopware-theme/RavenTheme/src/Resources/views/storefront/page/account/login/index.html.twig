{% sw_extends '@Storefront/storefront/base.html.twig' %}

{# Custom login page using Shopware's built-in login component #}

{# Set custom page title for login page #}
{% block base_head %}
    {% sw_include 'storefront/layout/meta.html.twig' with { customPageTitle: 'Anmelden | Raven Weapon AG' } %}
{% endblock %}

{% block base_esi_header %}{% endblock %}
{% block base_navigation_styling %}{% endblock %}
{% block base_esi_footer %}{% endblock %}
{% block base_flashbags %}{% endblock %}

{% block base_main %}
<main class="content-main">
<div class="raven-login-page">
    <div class="login-wrapper">
        {# Back to Home #}
        <a href="{{ path('frontend.home.page') }}" class="back-home-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 12H5"></path>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Zur Startseite
        </a>

        <div class="login-content">
            {# Left Side - Login Form using Shopware's built-in component #}
            <div class="login-card">
                {# Logo #}
                <div class="login-logo">
                    <a href="{{ path('frontend.home.page') }}">
                        <img src="{{ asset('bundles/raventheme/assets/raven-logo.png') }}" alt="Raven Weapon">
                    </a>
                </div>

                <div class="card-header">
                    <h1>Willkommen zurück</h1>
                    <p>Melden Sie sich bei Ihrem Konto an</p>
                </div>

                <form action="{{ path('frontend.account.login') }}"
                      method="post"
                      class="login-form"
                      data-form-handler="true">

                    <input type="hidden" name="redirectTo" value="{{ redirectTo|default('frontend.account.home.page') }}">
                    {% if redirectParameters is defined and redirectParameters is not empty and redirectParameters != '{"_noStore":true}' %}
                        <input type="hidden" name="redirectParameters" value="{{ redirectParameters }}">
                    {% endif %}

                    {% if loginError %}
                        <div class="login-error-alert">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                            <span>{{ errorSnippet|default('Die Anmeldedaten sind nicht korrekt.')|trans }}</span>
                        </div>
                    {% endif %}

                    <div class="form-group">
                        <label for="loginMail" class="form-label">E-Mail-Adresse</label>
                        <input type="email"
                               class="form-control"
                               id="loginMail"
                               name="username"
                               placeholder="ihre@email.de"
                               autocomplete="email"
                               required>
                    </div>

                    <div class="form-group">
                        <label for="loginPassword" class="form-label">Passwort</label>
                        <input type="password"
                               class="form-control"
                               id="loginPassword"
                               name="password"
                               placeholder="Ihr Passwort"
                               autocomplete="current-password"
                               required>
                    </div>

                    <div class="login-options">
                        <label class="remember-me">
                            <input type="checkbox" name="rememberLogin" value="1">
                            <span>Angemeldet bleiben</span>
                        </label>
                        <a href="{{ path('frontend.account.recover.page') }}" class="forgot-password">
                            Passwort vergessen?
                        </a>
                    </div>

                    <button type="submit" class="login-submit-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                            <polyline points="10 17 15 12 10 7"></polyline>
                            <line x1="15" y1="12" x2="3" y2="12"></line>
                        </svg>
                        Anmelden
                    </button>
                </form>

                {# Login Benefits #}
                <div class="login-benefits">
                    <p class="benefits-title">Vorteile für Kunden:</p>
                    <ul>
                        <li>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            Express-Kauf ohne Dateneingabe
                        </li>
                        <li>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            Bestellübersicht und Tracking
                        </li>
                        <li>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            Persönliche Einstellungen speichern
                        </li>
                    </ul>
                </div>
            </div>

            {# Right Side - Register Card #}
            <div class="register-card">
                <div class="card-header">
                    <h2>Neu hier?</h2>
                    <p>Erstellen Sie ein Konto und profitieren Sie von exklusiven Vorteilen</p>
                </div>

                <div class="register-benefits">
                    <div class="benefit-item">
                        <span class="benefit-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                        </span>
                        <div>
                            <strong>Schneller Checkout</strong>
                            <p>Ihre Daten werden gespeichert - schneller bestellen</p>
                        </div>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        </span>
                        <div>
                            <strong>Sendungsverfolgung</strong>
                            <p>Verfolgen Sie Ihre Bestellungen in Echtzeit</p>
                        </div>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                        </span>
                        <div>
                            <strong>Sicheres Konto</strong>
                            <p>Ihre Daten sind bei uns sicher aufbewahrt</p>
                        </div>
                    </div>
                </div>

                {# Pass redirectTo to register page so user returns to checkout after registration #}
                <a href="{{ path('frontend.account.register.page') }}{% if redirectTo %}?redirectTo={{ redirectTo }}{% endif %}" class="register-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <line x1="20" y1="8" x2="20" y2="14"></line>
                        <line x1="23" y1="11" x2="17" y2="11"></line>
                    </svg>
                    Konto erstellen
                </a>

                <p class="register-note">Kostenlos und unverbindlich</p>
            </div>
        </div>

        {# Trust Badges #}
        <div class="trust-badges">
            <div class="trust-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                SSL-verschlüsselt
            </div>
            <div class="trust-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                Sicher & Geschützt
            </div>
            <div class="trust-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                Sichere Bezahlung
            </div>
        </div>

    </div>
</div>
</main>

<style>
/* Raven Login Page Styles */
.raven-login-page {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 3rem 1.5rem;
    background: linear-gradient(180deg, #FDFCF9 0%, #F5F3EE 100%);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

.login-wrapper {
    width: 100%;
    max-width: 1000px;
    position: relative;
}

.back-home-btn {
    position: absolute;
    top: -3rem;
    left: 0;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 12px;
    color: #374151;
    font-size: 0.875rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
}

.back-home-btn:hover {
    background: #fff;
    color: #B8922E;
    border-color: #D4A847;
}

.login-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
}

@media (min-width: 768px) {
    .login-content {
        grid-template-columns: 1fr 1fr;
        gap: 3rem;
    }
}

/* Login Card */
.login-card {
    background: #fff;
    border-radius: 24px;
    padding: 2.5rem;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
}

.login-logo {
    text-align: center;
    margin-bottom: 1.5rem;
    height: 60px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

.login-logo img {
    height: 200px;
    width: auto;
}

.raven-login-page .card-header {
    text-align: center;
    margin-bottom: 1.5rem;
}

.raven-login-page .card-header h1,
.raven-login-page .card-header h2 {
    font-family: 'Chakra Petch', sans-serif;
    font-size: 1.75rem;
    font-weight: 700;
    color: #1A1A1A;
    margin: 0 0 0.5rem 0;
}

.raven-login-page .card-header p {
    font-size: 0.9375rem;
    color: #6b7280;
    margin: 0;
}

/* Login Form Styles */
.login-form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

.login-form .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.login-form .form-label {
    font-weight: 600;
    color: #1A1A1A;
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.login-form .form-control {
    border-radius: 14px;
    border: 2px solid #d1d5db;
    padding: 1rem 1.25rem;
    font-size: 1rem;
    transition: all 0.25s ease;
    width: 100%;
    box-sizing: border-box;
}

.login-form .form-control:focus {
    outline: none;
    border-color: #D4A847;
    box-shadow: 0 0 0 4px rgba(212, 168, 71, 0.15);
}

.login-options {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.remember-me {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    color: #374151;
}

.remember-me input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #D4A847;
    cursor: pointer;
}

.forgot-password {
    color: #B8922E;
    font-weight: 600;
    font-size: 0.875rem;
    text-decoration: none;
}

.forgot-password:hover {
    text-decoration: underline;
}

.login-submit-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.625rem;
    width: 100%;
    padding: 1rem 1.5rem;
    background: linear-gradient(135deg, #D4A847 0%, #E8C76B 50%, #D4A847 100%);
    background-size: 200% 100%;
    border: 2px solid #B8922E;
    border-radius: 14px;
    font-weight: 700;
    font-size: 1rem;
    color: #1A1A1A;
    box-shadow: 0 6px 20px rgba(212, 168, 71, 0.35);
    transition: all 0.3s ease;
    cursor: pointer;
}

.login-submit-btn:hover {
    background-position: 100% 0;
    transform: translateY(-2px);
    box-shadow: 0 10px 28px rgba(212, 168, 71, 0.45);
}

.login-error-alert {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    background: #fef2f2;
    border: 1px solid #fecaca;
    border-radius: 12px;
    color: #dc2626;
    font-size: 0.9375rem;
}

.login-error-alert svg {
    flex-shrink: 0;
}

/* Login Benefits */
.login-benefits {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #f3f4f6;
}

.benefits-title {
    font-size: 0.75rem;
    font-weight: 700;
    color: #6b7280;
    margin: 0 0 1rem 0;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.login-benefits ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.login-benefits li {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    color: #374151;
    margin-bottom: 0.5rem;
}

.login-benefits li svg {
    color: #D4A847;
    flex-shrink: 0;
}

/* Register Card */
.register-card {
    background: linear-gradient(180deg, #1A1A1A 0%, #111111 100%);
    border-radius: 24px;
    padding: 2.5rem;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
}

.register-card .card-header h2 {
    color: #fff;
}

.register-card .card-header p {
    color: rgba(255, 255, 255, 0.6);
}

.register-benefits {
    margin-bottom: 2rem;
}

.benefit-item {
    display: flex;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.benefit-item:last-child {
    border-bottom: none;
}

.benefit-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 52px;
    height: 52px;
    background: rgba(212, 168, 71, 0.15);
    border: 1px solid rgba(212, 168, 71, 0.25);
    border-radius: 14px;
    color: #D4A847;
    flex-shrink: 0;
}

.benefit-item strong {
    display: block;
    font-size: 1rem;
    color: #fff;
    margin-bottom: 0.25rem;
}

.benefit-item p {
    font-size: 0.875rem;
    color: rgba(255, 255, 255, 0.5);
    margin: 0;
}

.register-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.625rem;
    width: 100%;
    padding: 1rem 1.5rem;
    background: transparent;
    border: 2px solid #D4A847;
    border-radius: 14px;
    color: #D4A847;
    font-size: 1rem;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.3s ease;
}

.register-btn:hover {
    background: #D4A847;
    color: #1A1A1A;
    transform: translateY(-2px);
}

.register-note {
    text-align: center;
    font-size: 0.8125rem;
    color: rgba(255, 255, 255, 0.4);
    margin: 1rem 0 0 0;
}

/* Trust Badges */
.trust-badges {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    flex-wrap: wrap;
    margin-top: 2.5rem;
    padding: 1.25rem;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 16px;
}

.trust-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8125rem;
    font-weight: 500;
    color: #374151;
}

.trust-item svg {
    color: #D4A847;
}

/* Toast notification styles (inline for login page) */
#raven-toast-container {
    position: fixed;
    top: 24px;
    right: 24px;
    z-index: 99999;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
    max-width: calc(100vw - 48px);
}

.raven-toast {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-left-width: 4px;
    border-radius: 14px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
    pointer-events: auto;
    cursor: pointer;
    min-width: 320px;
    max-width: 420px;
    opacity: 0;
    transform: translateX(100%);
    transition: opacity 0.3s ease, transform 0.3s ease;
}

.raven-toast--visible {
    opacity: 1;
    transform: translateX(0);
}

.raven-toast--hiding {
    opacity: 0;
    transform: translateX(100%);
}

.raven-toast--error { border-left-color: #dc2626; }
.raven-toast--error .raven-toast__icon { color: #dc2626; }
.raven-toast--success { border-left-color: #D4A847; }
.raven-toast--success .raven-toast__icon { color: #D4A847; }
.raven-toast--warning { border-left-color: #f59e0b; }
.raven-toast--warning .raven-toast__icon { color: #f59e0b; }
.raven-toast--info { border-left-color: #3b82f6; }
.raven-toast--info .raven-toast__icon { color: #3b82f6; }

.raven-toast__icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.raven-toast__content {
    flex: 1;
    min-width: 0;
}

.raven-toast__message {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 15px;
    font-weight: 500;
    line-height: 1.5;
    color: #1f2937;
    word-wrap: break-word;
}

.raven-toast__close {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    margin: -4px -4px -4px 0;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: #9ca3af;
    cursor: pointer;
    transition: color 0.15s ease, background-color 0.15s ease;
}

.raven-toast__close:hover {
    color: #374151;
    background-color: rgba(0, 0, 0, 0.05);
}

@media (max-width: 480px) {
    #raven-toast-container {
        top: 16px;
        right: 16px;
        left: 16px;
        max-width: none;
    }
    .raven-toast {
        min-width: auto;
        max-width: none;
        width: 100%;
        transform: translateY(-100%);
    }
    .raven-toast--visible { transform: translateY(0); }
    .raven-toast--hiding { transform: translateY(-100%); }
}
</style>

<script>
// Raven Toast - Inline for login/register pages
(function() {
    const icons = {
        error: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',
        success: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="9 12 12 15 16 10"></polyline></svg>',
        warning: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',
        info: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'
    };

    const durations = { error: 5000, success: 3000, warning: 4000, info: 4000 };

    function getContainer() {
        let container = document.getElementById('raven-toast-container');
        if (!container) {
            container = document.createElement('div');
            container.id = 'raven-toast-container';
            document.body.appendChild(container);
        }
        return container;
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function removeToast(toast) {
        if (toast._removing) return;
        toast._removing = true;
        clearTimeout(toast._timeoutId);
        toast.classList.remove('raven-toast--visible');
        toast.classList.add('raven-toast--hiding');
        setTimeout(() => {
            if (toast.parentNode) toast.parentNode.removeChild(toast);
        }, 300);
    }

    window.ravenToast = function(type, message, duration) {
        const container = getContainer();
        const toast = document.createElement('div');
        toast.className = 'raven-toast raven-toast--' + type;
        toast.setAttribute('role', 'alert');

        toast.innerHTML =
            '<div class="raven-toast__icon">' + (icons[type] || icons.info) + '</div>' +
            '<div class="raven-toast__content"><span class="raven-toast__message">' + escapeHtml(message) + '</span></div>' +
            '<button class="raven-toast__close" type="button"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>';

        container.appendChild(toast);

        requestAnimationFrame(function() {
            toast.classList.add('raven-toast--visible');
        });

        const closeBtn = toast.querySelector('.raven-toast__close');
        closeBtn.addEventListener('click', function() { removeToast(toast); });
        toast.addEventListener('click', function(e) {
            if (e.target === toast || e.target.closest('.raven-toast__content')) {
                removeToast(toast);
            }
        });

        const dismissTime = duration || durations[type] || 4000;
        toast._timeoutId = setTimeout(function() { removeToast(toast); }, dismissTime);

        toast.addEventListener('mouseenter', function() { clearTimeout(toast._timeoutId); });
        toast.addEventListener('mouseleave', function() {
            toast._timeoutId = setTimeout(function() { removeToast(toast); }, 1000);
        });
    };

    console.log('Raven Toast initialized on login page');

    // ========== GERMAN TRANSLATIONS FOR SHOPWARE VALIDATION MESSAGES ==========
    const germanTranslations = {
        // Email validation
        'This value is already used.': 'Diese E-Mail-Adresse wird bereits verwendet.',
        'This email address is already registered.': 'Diese E-Mail-Adresse ist bereits registriert.',
        'The email address is already in use.': 'Diese E-Mail-Adresse wird bereits verwendet.',
        'This value is not a valid email address.': 'Bitte geben Sie eine gültige E-Mail-Adresse ein.',
        'Please enter a valid email address.': 'Bitte geben Sie eine gültige E-Mail-Adresse ein.',

        // Password validation
        'The password is too short.': 'Das Passwort ist zu kurz.',
        'The password must be at least 8 characters.': 'Das Passwort muss mindestens 8 Zeichen lang sein.',
        'The passwords do not match.': 'Die Passwörter stimmen nicht überein.',
        'The password confirmation does not match.': 'Die Passwortbestätigung stimmt nicht überein.',
        'Password must be at least {{ limit }} characters long.': 'Das Passwort muss mindestens 8 Zeichen lang sein.',
        'Invalid credentials.': 'Die Anmeldedaten sind nicht korrekt.',
        'Bad credentials.': 'Die Anmeldedaten sind nicht korrekt.',

        // Required fields
        'This field is required.': 'Dieses Feld ist erforderlich.',
        'This value should not be blank.': 'Dieses Feld darf nicht leer sein.',
        'Please fill out this field.': 'Bitte füllen Sie dieses Feld aus.',

        // Login errors
        'Customer with email address': 'Ein Kunde mit dieser E-Mail-Adresse wurde nicht gefunden.',
        'not found': 'nicht gefunden',
        'Your account is locked.': 'Ihr Konto ist gesperrt.',
        'Account is locked': 'Ihr Konto ist gesperrt.',
        'Too many login attempts.': 'Zu viele Anmeldeversuche. Bitte versuchen Sie es später erneut.',

        // General validation
        'An error occurred.': 'Ein Fehler ist aufgetreten.',
        'Please check your input.': 'Bitte überprüfen Sie Ihre Eingaben.',
        'The form contains errors.': 'Das Formular enthält Fehler.',
        'Login failed.': 'Anmeldung fehlgeschlagen.',

        // Account exists
        'A customer with the email address': 'Ein Kunde mit dieser E-Mail-Adresse existiert bereits.',
        'already exists': 'existiert bereits.',

        // Payment/Shipping change messages (cart validation)
        'payment is not available': 'Die Zahlungsart wurde automatisch angepasst.',
        'shipping is not available': 'Die Versandart wurde automatisch angepasst.',
        'was changed to': 'wurde geändert zu'
    };

    function translateToGerman(message) {
        // Direct match
        if (germanTranslations[message]) {
            return germanTranslations[message];
        }

        // Cart validation: Payment method changed
        if (message.toLowerCase().includes('payment') && message.toLowerCase().includes('not available')) {
            return 'Die Zahlungsart wurde automatisch angepasst.';
        }

        // Cart validation: Shipping method changed
        if (message.toLowerCase().includes('shipping') && message.toLowerCase().includes('not available')) {
            return 'Die Versandart wurde automatisch angepasst.';
        }

        // Partial match for messages containing dynamic values
        for (const [englishKey, germanValue] of Object.entries(germanTranslations)) {
            if (message.toLowerCase().includes(englishKey.toLowerCase())) {
                return germanValue;
            }
        }

        // Check for email already exists pattern
        if (message.toLowerCase().includes('already') && message.toLowerCase().includes('email')) {
            return 'Diese E-Mail-Adresse wird bereits verwendet.';
        }
        if (message.toLowerCase().includes('already') && message.toLowerCase().includes('customer')) {
            return 'Ein Kunde mit dieser E-Mail-Adresse existiert bereits.';
        }
        if (message.toLowerCase().includes('credentials') || message.toLowerCase().includes('invalid')) {
            return 'Die Anmeldedaten sind nicht korrekt.';
        }
        if (message.toLowerCase().includes('locked')) {
            return 'Ihr Konto ist gesperrt.';
        }

        // Return original if no translation found
        return message;
    }

    // ========== DYNAMIC ERROR/SUCCESS HANDLING ==========

    // 1. Login errors (Twig-based)
    {% if loginError %}
    window.ravenToast('error', translateToGerman('{{ errorSnippet|default('Die Anmeldedaten sind nicht korrekt.')|trans|e('js') }}'));
    {% endif %}

    // 2. Form violations (Shopware 6 passes these via formViolations)
    {% if formViolations is defined and formViolations is not empty %}
        {% for violation in formViolations %}
    window.ravenToast('error', translateToGerman('{{ violation.message|e('js') }}'));
        {% endfor %}
    {% endif %}

    // 3. Flash messages from Shopware (success, danger, warning, info)
    {% for type, messages in app.flashes() %}
        {% for message in messages %}
            {% if type == 'success' %}
    window.ravenToast('success', translateToGerman('{{ message|trans|e('js') }}'));
            {% elseif type == 'danger' or type == 'error' %}
    window.ravenToast('error', translateToGerman('{{ message|trans|e('js') }}'));
            {% elseif type == 'warning' %}
    window.ravenToast('warning', translateToGerman('{{ message|trans|e('js') }}'));
            {% else %}
    window.ravenToast('info', translateToGerman('{{ message|trans|e('js') }}'));
            {% endif %}
        {% endfor %}
    {% endfor %}

    // JavaScript fallback for URL params and DOM-based errors
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);

        // Login error via URL
        if (urlParams.get('loginError') === '1' || urlParams.has('loginError')) {
            window.ravenToast('error', 'Die Anmeldedaten sind nicht korrekt.');
        }

        // Success messages via URL (e.g., after logout, password reset)
        if (urlParams.has('logoutSuccess') || urlParams.get('logout') === '1') {
            window.ravenToast('success', 'Sie wurden erfolgreich abgemeldet.');
        }
        if (urlParams.has('passwordChanged') || urlParams.has('passwordReset')) {
            window.ravenToast('success', 'Ihr Passwort wurde erfolgreich geändert.');
        }
        if (urlParams.has('accountCreated') || urlParams.has('registered')) {
            window.ravenToast('success', 'Ihr Konto wurde erstellt. Bitte melden Sie sich an.');
        }

        // Check for inline error alert (from Shopware flash messages)
        const errorAlert = document.querySelector('.login-error-alert');
        if (errorAlert) {
            let message = errorAlert.querySelector('span')?.textContent || 'Die Anmeldedaten sind nicht korrekt.';
            message = translateToGerman(message.trim());
            window.ravenToast('error', message);
            errorAlert.style.display = 'none'; // Hide inline alert since we show toast
        }

        // Detect any .alert elements that Shopware might inject
        const alerts = document.querySelectorAll('.alert, .alert-danger, .alert-warning, .alert-success, .alert-info');
        alerts.forEach(function(alert) {
            let message = alert.textContent.trim();
            if (!message) return;

            // Translate English messages to German
            message = translateToGerman(message);

            let type = 'info';
            if (alert.classList.contains('alert-danger') || alert.classList.contains('alert-error')) {
                type = 'error';
            } else if (alert.classList.contains('alert-success')) {
                type = 'success';
            } else if (alert.classList.contains('alert-warning')) {
                type = 'warning';
            }

            window.ravenToast(type, message);
            alert.style.display = 'none'; // Hide original alert
        });

        // Detect Shopware form violation elements
        const violations = document.querySelectorAll('.invalid-feedback, .form-error, [data-form-violations]');
        violations.forEach(function(violation) {
            let message = violation.textContent.trim();
            if (message) {
                // Translate English messages to German
                message = translateToGerman(message);
                window.ravenToast('error', message);
            }
        });
    });
})();
</script>
{% endblock %}
