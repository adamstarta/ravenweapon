{% sw_extends '@Storefront/storefront/page/checkout/cart/index.html.twig' %}

{% block page_checkout_cart %}
<div class="raven-cart" style="max-width: 80rem; margin: 0 auto; padding: 2rem 1.5rem;">
    {# Cart Header #}
    <div style="display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; gap: 1rem;">
        <h1 style="font-family: 'Chakra Petch', sans-serif; font-size: 2rem; font-weight: 700; color: #111827; margin: 0;">
            Ihr Warenkorb
        </h1>
        {% if page.cart.lineItems.count > 0 %}
        <div style="font-size: 0.875rem; color: #374151;">
            {% set freeShippingThreshold = 59 %}
            {% set subtotal = page.cart.price.netPrice %}
            {% set remaining = freeShippingThreshold - subtotal %}
            {% if remaining > 0 %}
                {% set remainCents = ((remaining * 100) % 100)|round %}
                Nur {% if remainCents == 0 %}{{ remaining|number_format(0, '.', '') }}{% else %}{{ remaining|number_format(2, '.', '') }}{% endif %} mehr, um kostenlosen Versand zu erhalten!
                <a href="{{ path('frontend.home.page') }}" style="color: #2563EB; font-weight: 500;">Weiter einkaufen</a>
            {% else %}
                <span style="font-weight: 600; color: #047857;">Kostenloser Versand!</span>
            {% endif %}
        </div>
        {% endif %}
    </div>

    {# Login Requirement Notice for Guest Users #}
    {% if page.cart.lineItems.count > 0 and not context.customer %}
    <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FFFBEB 100%); border: 1px solid #F59E0B; border-radius: 12px; padding: 1.25rem 1.5rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; background: #F59E0B; border-radius: 50%; flex-shrink: 0;">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        </div>
        <div style="flex: 1; min-width: 200px;">
            <p style="font-weight: 600; color: #92400E; margin: 0 0 0.25rem 0; font-size: 1rem;">Anmeldung erforderlich</p>
            <p style="font-size: 0.875rem; color: #B45309; margin: 0;">Bitte melden Sie sich an oder erstellen Sie ein Konto, um zur Kasse zu gehen.</p>
        </div>
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
            <a href="{{ path('frontend.account.login.page') }}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.625rem 1.25rem; background: #111827; color: white; font-weight: 600; font-size: 0.875rem; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>
                Anmelden
            </a>
            <a href="{{ path('frontend.account.login.page') }}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.625rem 1.25rem; background: white; color: #111827; font-weight: 600; font-size: 0.875rem; border: 1px solid #D1D5DB; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                Konto erstellen
            </a>
        </div>
    </div>
    {% endif %}

    {% if page.cart.lineItems.count > 0 %}
    {# Cart Items #}
    <div id="cart-rows" style="border-top: 1px solid #E5E7EB;">
        {% for lineItem in page.cart.lineItems %}
        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid #E5E7EB;">
            {# Product Image #}
            <div style="width: 80px; height: 80px; min-width: 80px; background: white; border: 1px solid #E5E7EB; border-radius: 0.5rem; padding: 0.5rem; display: flex; align-items: center; justify-content: center;">
                {% if lineItem.cover %}
                <img src="{{ lineItem.cover.url }}" alt="{{ lineItem.label }}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                {% else %}
                <div style="width: 100%; height: 100%; background: #F3F4F6;"></div>
                {% endif %}
            </div>

            {# Product Info #}
            <div style="flex: 1; min-width: 0;">
                <p style="font-weight: 600; color: #111827; margin: 0 0 0.25rem 0;">{{ lineItem.label }}</p>
                {% set unitP = lineItem.price.unitPrice %}
                {% set unitCents = ((unitP * 100) % 100)|round %}
                <p style="font-size: 0.875rem; color: #6B7280; margin: 0;">{% if unitCents == 0 %}{{ unitP|number_format(0, '.', '') }}{% else %}{{ unitP|number_format(2, '.', '') }}{% endif %}</p>
            </div>

            {# Quantity Controls #}
            <div style="display: flex; align-items: center;">
                <form action="{{ path('frontend.checkout.line-item.change-quantity', { id: lineItem.id }) }}" method="post" style="display: inline-flex; border: 1px solid #D1D5DB; border-radius: 0.375rem; overflow: hidden;" data-form-csrf-handler="true">
                    <input type="hidden" name="redirectTo" value="frontend.checkout.cart.page">
                    <button type="button" onclick="var input = this.nextElementSibling; if(input.value > 1) { input.value--; this.closest('form').submit(); }" style="width: 32px; height: 32px; background: white; border: none; color: #6B7280; cursor: pointer;" aria-label="Menge verringern">−</button>
                    <input type="number" name="quantity" value="{{ lineItem.quantity }}" min="1" max="99" readonly style="width: 48px; height: 32px; text-align: center; border: none; border-left: 1px solid #D1D5DB; border-right: 1px solid #D1D5DB; font-weight: 500;">
                    <button type="button" onclick="var input = this.previousElementSibling; input.value++; this.closest('form').submit();" style="width: 32px; height: 32px; background: white; border: none; color: #6B7280; cursor: pointer;" aria-label="Menge erhöhen">+</button>
                </form>
            </div>

            {# Price and Remove #}
            <div style="display: flex; align-items: center; gap: 1rem;">
                {% set totalP = lineItem.price.totalPrice %}
                {% set totalCents = ((totalP * 100) % 100)|round %}
                <span style="font-weight: 600; color: #111827; min-width: 80px; text-align: right;">{% if totalCents == 0 %}{{ totalP|number_format(0, '.', '') }}{% else %}{{ totalP|number_format(2, '.', '') }}{% endif %}</span>
                <form action="{{ path('frontend.checkout.line-item.delete', { id: lineItem.id }) }}" method="post" data-form-csrf-handler="true">
                    <input type="hidden" name="redirectTo" value="frontend.checkout.cart.page">
                    <button type="submit" style="padding: 0.25rem; background: transparent; border: none; color: #9CA3AF; cursor: pointer;" aria-label="Entfernen">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                            <path fill="currentColor" d="M18.3 5.71a1 1 0 00-1.42 0L12 10.59 7.12 5.71A1 1 0 005.7 7.13L10.59 12l-4.9 4.88a1 1 0 101.42 1.42L12 13.41l4.88 4.89a1 1 0 001.42-1.42L13.41 12l4.89-4.88a1 1 0 000-1.41z"/>
                        </svg>
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>

    {# Summary Section #}
    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #E5E7EB;">
        <div style="display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 1rem;">
            <div>
                <div style="font-size: 1.25rem; font-weight: 600; color: #111827; display: flex; align-items: baseline; gap: 0.5rem;">
                    <span>Zwischensumme</span>
                    {% set subP = page.cart.price.totalPrice %}
                    {% set subCents = ((subP * 100) % 100)|round %}
                    <span style="font-weight: 700;">{% if subCents == 0 %}{{ subP|number_format(0, '.', '') }}{% else %}{{ subP|number_format(2, '.', '') }}{% endif %}</span>
                </div>
                <p style="font-size: 0.875rem; color: #6B7280; margin: 0.25rem 0 0 0;">Inklusive Steuer. Versandkosten werden an der Kasse berechnet.</p>
            </div>
            {% if context.customer %}
            <a href="{{ path('frontend.checkout.confirm.page') }}" style="display: inline-flex; align-items: center; justify-content: center; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; color: #111827; text-decoration: none; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); border: 1px solid #C59A0F; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                Zur Kasse
            </a>
            {% else %}
            <a href="{{ path('frontend.account.login.page') }}" style="display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; color: #111827; text-decoration: none; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); border: 1px solid #C59A0F; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>
                Anmelden um fortzufahren
            </a>
            {% endif %}
        </div>
    </div>

    {% else %}
    {# Empty Cart State #}
    <div style="text-align: center; padding: 4rem 1rem;">
        <svg style="width: 96px; height: 96px; margin: 0 auto 1rem; color: #D1D5DB;" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        <p style="font-size: 1.125rem; font-weight: 500; color: #374151; margin: 0 0 0.5rem 0;">Ihr Warenkorb ist leer</p>
        <p style="font-size: 0.875rem; color: #9CA3AF; margin: 0 0 1.5rem 0;">Fügen Sie Produkte hinzu, um fortzufahren</p>
        <a href="{{ path('frontend.home.page') }}" style="display: inline-flex; align-items: center; justify-content: center; padding: 0.625rem 1.25rem; border-radius: 0.5rem; font-weight: 600; color: #111827; text-decoration: none; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); border: 1px solid #C59A0F; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
            Weiter einkaufen
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
