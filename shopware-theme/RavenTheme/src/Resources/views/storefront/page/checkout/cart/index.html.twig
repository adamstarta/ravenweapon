{% sw_extends '@Storefront/storefront/page/checkout/cart/index.html.twig' %}

{# Hide the default Shopware summary sidebar #}
{% block page_checkout_cart_container_summary %}{% endblock %}

{% block page_checkout_cart %}
<style>
/* Hide the entire Shopware default Summary sidebar - we have our own */
.checkout-aside,
.checkout-aside-container,
.col-lg-4.checkout-aside-container,
.checkout-aside-summary,
.checkout-aside-action,
[class*="checkout-aside"] {
    display: none !important;
}

/* Make main cart area full width */
.checkout-main,
.col-lg-8 {
    flex: 0 0 100% !important;
    max-width: 100% !important;
}

/* Hide number input spinner arrows and center text */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none !important;
    margin: 0 !important;
}
input[type="number"] {
    -moz-appearance: textfield !important;
    text-align: center !important;
}
</style>
<div class="raven-cart" style="max-width: 80rem; margin: 0 auto; padding: 2rem 1.5rem;">
    {# Cart Header #}
    <div style="margin-bottom: 1.5rem;">
        <h1 style="font-family: 'Chakra Petch', sans-serif; font-size: 2rem; font-weight: 700; color: #111827; margin: 0;">
            Ihr Warenkorb
        </h1>
    </div>

    {# Login Requirement Notice for Guest Users #}
    {% if page.cart.lineItems.count > 0 and not context.customer %}
    <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FFFBEB 100%); border: 1px solid #F59E0B; border-radius: 12px; padding: 1.25rem 1.5rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; background: #F59E0B; border-radius: 50%; flex-shrink: 0;">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        </div>
        <div style="flex: 1; min-width: 200px;">
            <p style="font-weight: 600; color: #92400E; margin: 0 0 0.25rem 0; font-size: 1rem;">Anmeldung erforderlich</p>
            <p style="font-size: 0.875rem; color: #B45309; margin: 0;">Bitte melden Sie sich an oder erstellen Sie ein Konto, um zur Kasse zu gehen.</p>
        </div>
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
            <a href="{{ path('frontend.account.login.page') }}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.625rem 1.25rem; background: #111827; color: white; font-weight: 600; font-size: 0.875rem; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>
                Anmelden
            </a>
            <a href="{{ path('frontend.account.login.page') }}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.625rem 1.25rem; background: white; color: #111827; font-weight: 600; font-size: 0.875rem; border: 1px solid #D1D5DB; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                Konto erstellen
            </a>
        </div>
    </div>
    {% endif %}

    {% if page.cart.lineItems.count > 0 %}
    {# Cart Items #}
    <div id="cart-rows" style="border-top: 1px solid #E5E7EB;">
        {% for lineItem in page.cart.lineItems %}
        <div style="display: flex; flex-direction: column; gap: 1rem; padding: 1.5rem 0; border-bottom: 1px solid #E5E7EB;">
            {# Top Row: Image + Info + Remove #}
            <div style="display: flex; align-items: flex-start; gap: 1rem;">
                {# Product Image #}
                <div style="width: 100px; height: 100px; min-width: 100px; background: white; border: 1px solid #E5E7EB; border-radius: 0.75rem; padding: 0.5rem; display: flex; align-items: center; justify-content: center;">
                    {% if lineItem.cover %}
                    <img src="{{ lineItem.cover.url }}" alt="{{ lineItem.label }}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                    {% else %}
                    <div style="width: 100%; height: 100%; background: #F3F4F6; border-radius: 0.5rem;"></div>
                    {% endif %}
                </div>

                {# Product Info #}
                <div style="flex: 1; min-width: 0;">
                    <p style="font-weight: 700; color: #111827; margin: 0 0 0.5rem 0; font-size: 1.125rem;">{{ lineItem.label }}</p>
                    {% if lineItem.payload.variantenDisplay is defined and lineItem.payload.variantenDisplay %}
                    <p style="font-size: 0.875rem; color: #D97706; font-weight: 600; margin: 0 0 0.5rem 0;">Variante: {{ lineItem.payload.variantenDisplay }}</p>
                    {% elseif lineItem.payload.selectedColor is defined and lineItem.payload.selectedColor %}
                    <p style="font-size: 0.875rem; color: #D97706; font-weight: 600; margin: 0 0 0.5rem 0;">Variante: {{ lineItem.payload.selectedColor }}</p>
                    {% elseif lineItem.payload.selectedSize is defined and lineItem.payload.selectedSize %}
                    <p style="font-size: 0.875rem; color: #D97706; font-weight: 600; margin: 0 0 0.5rem 0;">Variante: {{ lineItem.payload.selectedSize }}</p>
                    {% endif %}
                    {% set unitP = lineItem.price.unitPrice %}
                    <p style="font-size: 1rem; color: #6B7280; margin: 0;">Stückpreis: CHF {{ unitP|number_format(2, '.', "'") }}</p>
                </div>

                {# Remove Button #}
                <form action="{{ path('frontend.checkout.line-item.delete', { id: lineItem.id }) }}" method="post" data-form-csrf-handler="true">
                    <input type="hidden" name="redirectTo" value="frontend.checkout.cart.page">
                    <button type="submit" style="padding: 0.5rem; background: #FEF2F2; border: 1px solid #FECACA; border-radius: 0.5rem; color: #EF4444; cursor: pointer;" aria-label="Entfernen">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                            <path fill="currentColor" d="M18.3 5.71a1 1 0 00-1.42 0L12 10.59 7.12 5.71A1 1 0 005.7 7.13L10.59 12l-4.9 4.88a1 1 0 101.42 1.42L12 13.41l4.88 4.89a1 1 0 001.42-1.42L13.41 12l4.89-4.88a1 1 0 000-1.41z"/>
                        </svg>
                    </button>
                </form>
            </div>

            {# Bottom Row: Quantity Controls + Total Price #}
            <div style="display: flex; flex-direction: row; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; background: #F9FAFB; border-radius: 0.75rem; margin-top: 0.5rem;">
                {# Quantity Controls #}
                <div style="display: flex; flex-direction: row; align-items: center; gap: 0.75rem;">
                    <span style="font-size: 0.875rem; color: #6B7280; font-weight: 500;">Menge:</span>
                    <form action="{{ path('frontend.checkout.line-item.change-quantity', { id: lineItem.id }) }}" method="post" style="display: flex; flex-direction: row; align-items: center; border: 1px solid #D1D5DB; border-radius: 0.5rem; overflow: hidden; background: white;" data-form-csrf-handler="true">
                        <input type="hidden" name="redirectTo" value="frontend.checkout.cart.page">
                        <button type="button" onclick="var input = this.nextElementSibling; if(input.value > 1) { input.value--; this.closest('form').submit(); }" style="width: 44px; height: 44px; background: white; border: none; color: #374151; cursor: pointer; font-size: 1.5rem; font-weight: 400; display: flex; align-items: center; justify-content: center;" aria-label="Menge verringern">−</button>
                        <input type="number" name="quantity" value="{{ lineItem.quantity }}" min="1" max="99" readonly style="width: 50px; height: 44px; text-align: center; border: none; border-left: 1px solid #E5E7EB; border-right: 1px solid #E5E7EB; font-weight: 700; font-size: 1.125rem; color: #111827; background: white; -moz-appearance: textfield; -webkit-appearance: none; appearance: none; padding: 0; margin: 0;">
                        <button type="button" onclick="var input = this.previousElementSibling; input.value++; this.closest('form').submit();" style="width: 44px; height: 44px; background: white; border: none; color: #374151; cursor: pointer; font-size: 1.5rem; font-weight: 400; display: flex; align-items: center; justify-content: center;" aria-label="Menge erhöhen">+</button>
                    </form>
                </div>

                {# Total Price #}
                {% set totalP = lineItem.price.totalPrice %}
                <div style="text-align: right;">
                    <span style="font-size: 0.75rem; color: #6B7280; display: block;">Gesamt</span>
                    <span style="font-weight: 700; color: #111827; font-size: 1.25rem;">CHF {{ totalP|number_format(2, '.', "'") }}</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {# Summary Section #}
    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #E5E7EB;">
        <div style="display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 1rem;">
            <div>
                <div style="font-size: 1.25rem; font-weight: 600; color: #111827; display: flex; align-items: baseline; gap: 0.5rem;">
                    <span>Zwischensumme</span>
                    {% set subP = page.cart.price.totalPrice %}
                    <span style="font-weight: 700;">CHF {{ subP|number_format(2, '.', "'") }}</span>
                </div>
                <p style="font-size: 0.875rem; color: #6B7280; margin: 0.25rem 0 0 0;">Inklusive Steuer. Versandkosten werden an der Kasse berechnet.</p>
            </div>
            {% if context.customer %}
            <a href="{{ path('frontend.checkout.confirm.page') }}" style="display: inline-flex; align-items: center; justify-content: center; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; color: #111827; text-decoration: none; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); border: 1px solid #C59A0F; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                Zur Kasse
            </a>
            {% else %}
            <a href="{{ path('frontend.account.login.page') }}" style="display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; color: #111827; text-decoration: none; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); border: 1px solid #C59A0F; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>
                Anmelden um fortzufahren
            </a>
            {% endif %}
        </div>
    </div>

    {% else %}
    {# Empty Cart State #}
    <div style="text-align: center; padding: 4rem 1rem;">
        <svg style="width: 96px; height: 96px; margin: 0 auto 1rem; color: #D1D5DB;" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        <p style="font-size: 1.125rem; font-weight: 500; color: #374151; margin: 0 0 0.5rem 0;">Ihr Warenkorb ist leer</p>
        <p style="font-size: 0.875rem; color: #9CA3AF; margin: 0 0 1.5rem 0;">Fügen Sie Produkte hinzu, um fortzufahren</p>
        <a href="{{ path('frontend.home.page') }}" style="display: inline-flex; align-items: center; justify-content: center; padding: 0.625rem 1.25rem; border-radius: 0.5rem; font-weight: 600; color: #111827; text-decoration: none; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); border: 1px solid #C59A0F; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
            Weiter einkaufen
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
