{% sw_extends '@Storefront/storefront/page/content/index.html.twig' %}

{% block base_main_inner %}
{# Only show custom homepage for the root navigation/homepage #}
{% if page.header.navigation.active.id == page.header.navigation.active.path|first or page.cmsPage.type == 'landingpage' %}

{# Hide Shopware flash messages - we use cart sidebar instead #}
<style>
    .alert[role="alert"],
    .flashbags,
    .alert-content,
    .alert.alert-info,
    .alert.alert-success,
    .alert.alert-warning {
        display: none !important;
    }
</style>

<main class="raven-homepage">

    {# ========================================== #}
    {# HERO SECTION #}
    {# ========================================== #}
    <section class="raven-hero relative w-full overflow-hidden" style="min-height: 520px; padding: 6rem 0 4rem;">
        <div class="absolute inset-0 bg-cover bg-center bg-no-repeat" style="background-image: url('{{ asset('bundles/raventheme/assets/wallpaper hero.png') }}');"></div>
        <div class="absolute inset-0" style="background: linear-gradient(to bottom, rgba(0,0,0,0.25), rgba(0,0,0,0.55), rgba(0,0,0,0.65));"></div>

        <div class="relative z-10 max-w-7xl mx-auto px-6 lg:px-24 text-white">
            <h1 class="raven-hero-title mb-3" style="font-family: 'Chakra Petch', sans-serif; font-size: clamp(2rem, 5vw, 4rem); font-weight: 700; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; line-height: 1.3; padding-top: 0.15em;">
                RAVEN WEAPON AG
            </h1>

            <h2 style="font-family: 'Chakra Petch', sans-serif; font-size: clamp(1.25rem, 3vw, 2.5rem); font-weight: 400; color: white; margin-bottom: 1.5rem; max-width: 42rem;">
                Eine Waffe für jede Mission,<br>genau wie Du sie willst
            </h2>

            <ul style="font-family: 'Chakra Petch', sans-serif; font-size: clamp(1rem, 2vw, 1.75rem); font-weight: 600; color: white; margin-bottom: 2.5rem; list-style: none; padding-left: 2rem;">
                <li style="position: relative; margin-bottom: 0.25rem;">
                    <span style="position: absolute; left: -1.5rem; top: 50%; transform: translateY(-50%); width: 0.5rem; height: 0.5rem; background: white; border-radius: 50%;"></span>
                    Schweizer Familienbetrieb
                </li>
                <li style="position: relative; margin-bottom: 0.25rem;">
                    <span style="position: absolute; left: -1.5rem; top: 50%; transform: translateY(-50%); width: 0.5rem; height: 0.5rem; background: white; border-radius: 50%;"></span>
                    Made in Canada
                </li>
                <li style="position: relative;">
                    <span style="position: absolute; left: -1.5rem; top: 50%; transform: translateY(-50%); width: 0.5rem; height: 0.5rem; background: white; border-radius: 50%;"></span>
                    Höchste Qualität
                </li>
            </ul>

            <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
                <a href="{{ path('frontend.home.page') }}" class="btn btn-primary" style="display: inline-flex; align-items: center; padding: 0.5rem 1.25rem; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); color: #1f2937; font-weight: 600; border-radius: 0.5rem; text-decoration: none; border: 1px solid #C59A0F; box-shadow: 0 2px 6px rgba(0,0,0,0.25);">
                    {% sw_icon 'bag' style { 'size': 'sm' } %}
                    <span style="margin-left: 0.5rem;">Zum Shop</span>
                </a>
                <a href="{{ path('frontend.cms.page', { id: 'about-us' }) }}" style="display: inline-flex; align-items: center; padding: 0.5rem 1rem; background: white; color: #414651; font-weight: 600; border-radius: 0.5rem; text-decoration: none; border: 1px solid #d1d5db; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    Über uns
                    <svg style="width: 1rem; height: 1rem; margin-left: 0.5rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"></path></svg>
                </a>
            </div>
        </div>
    </section>

    {# ========================================== #}
    {# PRODUCTS SECTION - 3 Rifles + 3 Caliber Kits #}
    {# ========================================== #}
    <style>
        @media (min-width: 640px) { .raven-product-grid { grid-template-columns: repeat(2, 1fr) !important; } }
        @media (min-width: 768px) { .raven-product-grid { grid-template-columns: repeat(3, 1fr) !important; } }
        /* Clean product cards - NO borders, just floating on white */
        .raven-product-card {
            transition: all 0.3s ease;
            position: relative;
            background: white !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            overflow: visible !important;
        }
        .raven-product-card:hover .product-img { transform: scale(1.05); }
        .product-img { transition: transform 0.3s ease; }
        /* Vertical gold divider in the CENTER of gap between products */
        .raven-product-card::after {
            content: '' !important;
            position: absolute !important;
            right: -1rem !important;
            top: 10% !important;
            height: 80% !important;
            width: 2px !important;
            background: #D4A847 !important;
            display: block !important;
        }
        @media (min-width: 768px) {
            .raven-product-card:nth-child(3n)::after { display: none !important; }
        }
        @media (min-width: 640px) and (max-width: 767px) {
            .raven-product-card:nth-child(2n)::after { display: none !important; }
        }
        @media (max-width: 639px) {
            .raven-product-card::after { display: none !important; }
        }
    </style>
    <section class="raven-products bg-white" style="padding: 3rem 0 4rem;">
        <div class="max-w-7xl mx-auto px-6 lg:px-24">
            <div style="display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 1rem; margin-bottom: 2.5rem;">
                <h2 style="font-family: 'Chakra Petch', sans-serif; font-size: clamp(2rem, 4vw, 4rem); font-weight: 400; color: #111827; line-height: 1.1;">
                    Beliebte Produkte
                </h2>
                <a href="{{ path('frontend.home.page') }}" class="btn btn-primary" style="display: inline-flex; align-items: center; padding: 0.5rem 1.25rem; background: linear-gradient(to top, #F2B90D 12%, #F6CE55 88%); color: #1f2937; font-weight: 600; border-radius: 0.5rem; text-decoration: none; border: 1px solid #C59A0F; box-shadow: 0 2px 6px rgba(0,0,0,0.25);">
                    {% sw_icon 'bag' style { 'size': 'sm' } %}
                    <span style="margin-left: 0.5rem;">Zum gesamten Sortiment</span>
                </a>
            </div>

            {# Product Grid - 6 Products (3 columns on desktop) #}
            <div class="raven-product-grid" style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 2rem;">

                {# Rifle 1: .223 RAVEN #}
                <article class="raven-product-card" style="background: white; cursor: pointer;">
                    <a href="{{ seoUrl('frontend.detail.page', { productId: '019ac3a6576172c3b53d1d9c7b915a6b' }) }}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="height: 18rem; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <img class="product-img" src="{{ asset('bundles/raventheme/assets/223raven.png') }}" alt=".223 RAVEN" style="max-width: 100%; max-height: 100%; object-fit: contain; padding: 0.75rem;">
                        </div>
                    </a>
                    <div style="padding: 0.75rem 0 1rem;">
                        <p style="font-size: 12px; line-height: 16px; color: #6B7280; margin: 0 0 0.5rem 0;">Waffe</p>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 0.75rem;">
                            <div style="flex: 1;">
                                <div style="color: #E53935; font-weight: 600; font-size: 16px; line-height: 1.2;">2985.–</div>
                                <div style="color: #374151; font-size: 1rem; margin-top: 0.25rem;"><span style="font-weight: 700;">Lockhart Tactical</span> .223 RAVEN</div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; margin-top: -0.5rem;">
                                <span style="width: 20px; height: 20px; border-radius: 50%; background: #77C15A; display: inline-flex; align-items: center; justify-content: center;" title="Verfügbar">
                                    <svg viewBox="0 0 24 24" fill="none" style="width: 12px; height: 12px;"><path d="M5 13l4 4L19 7" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                </span>
                                <form action="{{ path('frontend.checkout.line-item.add') }}" method="post" data-form-csrf-handler="true">
                                    <input type="hidden" name="redirectTo" value="frontend.cart.offcanvas">
                                    <input type="hidden" name="lineItems[019ac3a6576172c3b53d1d9c7b915a6b][id]" value="019ac3a6576172c3b53d1d9c7b915a6b">
                                    <input type="hidden" name="lineItems[019ac3a6576172c3b53d1d9c7b915a6b][quantity]" class="js-quantity-selector" value="1">
                                    <input type="hidden" name="lineItems[019ac3a6576172c3b53d1d9c7b915a6b][type]" value="product">
                                    <input type="hidden" name="lineItems[019ac3a6576172c3b53d1d9c7b915a6b][referencedId]" value="019ac3a6576172c3b53d1d9c7b915a6b">
                                    <input type="hidden" name="lineItems[019ac3a6576172c3b53d1d9c7b915a6b][stackable]" value="1">
                                    <input type="hidden" name="lineItems[019ac3a6576172c3b53d1d9c7b915a6b][removable]" value="1">
                                    <button type="submit" style="width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; background: transparent; border: none; color: #374151; cursor: pointer;" title="In den Warenkorb">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" style="width: 24px; height: 24px;"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </article>

                {# Rifle 2: 300 AAC RAVEN #}
                <article class="raven-product-card" style="background: white; cursor: pointer;">
                    <a href="{{ seoUrl('frontend.detail.page', { productId: '019ac3a704e0712ba03fe63f85004924' }) }}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="height: 18rem; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <img class="product-img" src="{{ asset('bundles/raventheme/assets/300 AAC RAVEN.png') }}" alt="300 AAC RAVEN" style="max-width: 100%; max-height: 100%; object-fit: contain; padding: 0.75rem;">
                        </div>
                    </a>
                    <div style="padding: 0.75rem 0 1rem;">
                        <p style="font-size: 12px; line-height: 16px; color: #6B7280; margin: 0 0 0.5rem 0;">Waffe</p>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 0.75rem;">
                            <div style="flex: 1;">
                                <div style="color: #E53935; font-weight: 600; font-size: 16px; line-height: 1.2;">3150.–</div>
                                <div style="color: #374151; font-size: 1rem; margin-top: 0.25rem;"><span style="font-weight: 700;">Lockhart Tactical</span> 300 AAC RAVEN</div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; margin-top: -0.5rem;">
                                <span style="width: 20px; height: 20px; border-radius: 50%; background: #77C15A; display: inline-flex; align-items: center; justify-content: center;" title="Verfügbar">
                                    <svg viewBox="0 0 24 24" fill="none" style="width: 12px; height: 12px;"><path d="M5 13l4 4L19 7" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                </span>
                                <form action="{{ path('frontend.checkout.line-item.add') }}" method="post" data-form-csrf-handler="true">
                                    <input type="hidden" name="redirectTo" value="frontend.cart.offcanvas">
                                    <input type="hidden" name="lineItems[019ac3a704e0712ba03fe63f85004924][id]" value="019ac3a704e0712ba03fe63f85004924">
                                    <input type="hidden" name="lineItems[019ac3a704e0712ba03fe63f85004924][quantity]" class="js-quantity-selector" value="1">
                                    <input type="hidden" name="lineItems[019ac3a704e0712ba03fe63f85004924][type]" value="product">
                                    <input type="hidden" name="lineItems[019ac3a704e0712ba03fe63f85004924][referencedId]" value="019ac3a704e0712ba03fe63f85004924">
                                    <input type="hidden" name="lineItems[019ac3a704e0712ba03fe63f85004924][stackable]" value="1">
                                    <input type="hidden" name="lineItems[019ac3a704e0712ba03fe63f85004924][removable]" value="1">
                                    <button type="submit" style="width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; background: transparent; border: none; color: #374151; cursor: pointer;" title="In den Warenkorb">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" style="width: 24px; height: 24px;"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </article>

                {# Rifle 3: 7.62x39 RAVEN #}
                <article class="raven-product-card" style="background: white; cursor: pointer;">
                    <a href="{{ seoUrl('frontend.detail.page', { productId: '019ac3a70722706db918ab6b3e182a86' }) }}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="height: 18rem; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <img class="product-img" src="{{ asset('bundles/raventheme/assets/7.62×39 RAVEN.png') }}" alt="7.62x39 RAVEN" style="max-width: 100%; max-height: 100%; object-fit: contain; padding: 0.75rem;">
                        </div>
                    </a>
                    <div style="padding: 0.75rem 0 1rem;">
                        <p style="font-size: 12px; line-height: 16px; color: #6B7280; margin: 0 0 0.5rem 0;">Waffe</p>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 0.75rem;">
                            <div style="flex: 1;">
                                <div style="color: #E53935; font-weight: 600; font-size: 16px; line-height: 1.2;">3150.–</div>
                                <div style="color: #374151; font-size: 1rem; margin-top: 0.25rem;"><span style="font-weight: 700;">Lockhart Tactical</span> 7.62×39 RAVEN</div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; margin-top: -0.5rem;">
                                <span style="width: 20px; height: 20px; border-radius: 50%; background: #77C15A; display: inline-flex; align-items: center; justify-content: center;" title="Verfügbar">
                                    <svg viewBox="0 0 24 24" fill="none" style="width: 12px; height: 12px;"><path d="M5 13l4 4L19 7" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                </span>
                                <form action="{{ path('frontend.checkout.line-item.add') }}" method="post" data-form-csrf-handler="true">
                                    <input type="hidden" name="redirectTo" value="frontend.cart.offcanvas">
                                    <input type="hidden" name="lineItems[019ac3a70722706db918ab6b3e182a86][id]" value="019ac3a70722706db918ab6b3e182a86">
                                    <input type="hidden" name="lineItems[019ac3a70722706db918ab6b3e182a86][quantity]" class="js-quantity-selector" value="1">
                                    <input type="hidden" name="lineItems[019ac3a70722706db918ab6b3e182a86][type]" value="product">
                                    <input type="hidden" name="lineItems[019ac3a70722706db918ab6b3e182a86][referencedId]" value="019ac3a70722706db918ab6b3e182a86">
                                    <input type="hidden" name="lineItems[019ac3a70722706db918ab6b3e182a86][stackable]" value="1">
                                    <input type="hidden" name="lineItems[019ac3a70722706db918ab6b3e182a86][removable]" value="1">
                                    <button type="submit" style="width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; background: transparent; border: none; color: #374151; cursor: pointer;" title="In den Warenkorb">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" style="width: 24px; height: 24px;"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </article>

                {# Caliber Kit 1: .223 CALIBER KIT #}
                <article class="raven-product-card" style="background: white; cursor: pointer;">
                    <a href="{{ seoUrl('frontend.detail.page', { productId: '019ac3a76eda703a9d10f8c1fba4c247' }) }}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="height: 18rem; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <img class="product-img" src="{{ asset('bundles/raventheme/assets/.223 CALIBER KIT.png') }}" alt=".223 CALIBER KIT" style="max-width: 100%; max-height: 100%; object-fit: contain; padding: 0.75rem;">
                        </div>
                    </a>
                    <div style="padding: 0.75rem 0 1rem;">
                        <p style="font-size: 12px; line-height: 16px; color: #6B7280; margin: 0 0 0.5rem 0;">Zubehör</p>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 0.75rem;">
                            <div style="flex: 1;">
                                <div style="color: #E53935; font-weight: 600; font-size: 16px; line-height: 1.2;">1849.–</div>
                                <div style="color: #374151; font-size: 1rem; margin-top: 0.25rem;"><span style="font-weight: 700;">Lockhart Tactical</span> .223 CALIBER KIT</div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; margin-top: -0.5rem;">
                                <span style="width: 20px; height: 20px; border-radius: 50%; background: #77C15A; display: inline-flex; align-items: center; justify-content: center;" title="Verfügbar">
                                    <svg viewBox="0 0 24 24" fill="none" style="width: 12px; height: 12px;"><path d="M5 13l4 4L19 7" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                </span>
                                <form action="{{ path('frontend.checkout.line-item.add') }}" method="post" data-form-csrf-handler="true">
                                    <input type="hidden" name="redirectTo" value="frontend.cart.offcanvas">
                                    <input type="hidden" name="lineItems[019ac3a76eda703a9d10f8c1fba4c247][id]" value="019ac3a76eda703a9d10f8c1fba4c247">
                                    <input type="hidden" name="lineItems[019ac3a76eda703a9d10f8c1fba4c247][quantity]" class="js-quantity-selector" value="1">
                                    <input type="hidden" name="lineItems[019ac3a76eda703a9d10f8c1fba4c247][type]" value="product">
                                    <input type="hidden" name="lineItems[019ac3a76eda703a9d10f8c1fba4c247][referencedId]" value="019ac3a76eda703a9d10f8c1fba4c247">
                                    <input type="hidden" name="lineItems[019ac3a76eda703a9d10f8c1fba4c247][stackable]" value="1">
                                    <input type="hidden" name="lineItems[019ac3a76eda703a9d10f8c1fba4c247][removable]" value="1">
                                    <button type="submit" style="width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; background: transparent; border: none; color: #374151; cursor: pointer;" title="In den Warenkorb">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" style="width: 24px; height: 24px;"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </article>

                {# Caliber Kit 2: 300 AAC CALIBER KIT #}
                <article class="raven-product-card" style="background: white; cursor: pointer;">
                    <a href="{{ seoUrl('frontend.detail.page', { productId: '019ac3a7780273c0b1433958b6ba85ed' }) }}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="height: 18rem; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <img class="product-img" src="{{ asset('bundles/raventheme/assets/300 AAC CALIBER KIT.png') }}" alt="300 AAC CALIBER KIT" style="max-width: 100%; max-height: 100%; object-fit: contain; padding: 0.75rem;">
                        </div>
                    </a>
                    <div style="padding: 0.75rem 0 1rem;">
                        <p style="font-size: 12px; line-height: 16px; color: #6B7280; margin: 0 0 0.5rem 0;">Zubehör</p>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 0.75rem;">
                            <div style="flex: 1;">
                                <div style="color: #E53935; font-weight: 600; font-size: 16px; line-height: 1.2;">1949.–</div>
                                <div style="color: #374151; font-size: 1rem; margin-top: 0.25rem;"><span style="font-weight: 700;">Lockhart Tactical</span> 300 AAC CALIBER KIT</div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; margin-top: -0.5rem;">
                                <span style="width: 20px; height: 20px; border-radius: 50%; background: #77C15A; display: inline-flex; align-items: center; justify-content: center;" title="Verfügbar">
                                    <svg viewBox="0 0 24 24" fill="none" style="width: 12px; height: 12px;"><path d="M5 13l4 4L19 7" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                </span>
                                <form action="{{ path('frontend.checkout.line-item.add') }}" method="post" data-form-csrf-handler="true">
                                    <input type="hidden" name="redirectTo" value="frontend.cart.offcanvas">
                                    <input type="hidden" name="lineItems[019ac3a7780273c0b1433958b6ba85ed][id]" value="019ac3a7780273c0b1433958b6ba85ed">
                                    <input type="hidden" name="lineItems[019ac3a7780273c0b1433958b6ba85ed][quantity]" class="js-quantity-selector" value="1">
                                    <input type="hidden" name="lineItems[019ac3a7780273c0b1433958b6ba85ed][type]" value="product">
                                    <input type="hidden" name="lineItems[019ac3a7780273c0b1433958b6ba85ed][referencedId]" value="019ac3a7780273c0b1433958b6ba85ed">
                                    <input type="hidden" name="lineItems[019ac3a7780273c0b1433958b6ba85ed][stackable]" value="1">
                                    <input type="hidden" name="lineItems[019ac3a7780273c0b1433958b6ba85ed][removable]" value="1">
                                    <button type="submit" style="width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; background: transparent; border: none; color: #374151; cursor: pointer;" title="In den Warenkorb">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" style="width: 24px; height: 24px;"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </article>

                {# Caliber Kit 3: 7.62x39 CALIBER KIT #}
                <article class="raven-product-card" style="background: white; cursor: pointer;">
                    <a href="{{ seoUrl('frontend.detail.page', { productId: '019ac3a775c771e992f10c480dc41ffd' }) }}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="height: 18rem; background: white; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <img class="product-img" src="{{ asset('bundles/raventheme/assets/7.62X39 CALIBER KIT.png') }}" alt="7.62x39 CALIBER KIT" style="max-width: 100%; max-height: 100%; object-fit: contain; padding: 0.75rem;">
                        </div>
                    </a>
                    <div style="padding: 0.75rem 0 1rem;">
                        <p style="font-size: 12px; line-height: 16px; color: #6B7280; margin: 0 0 0.5rem 0;">Zubehör</p>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 0.75rem;">
                            <div style="flex: 1;">
                                <div style="color: #E53935; font-weight: 600; font-size: 16px; line-height: 1.2;">1949.–</div>
                                <div style="color: #374151; font-size: 1rem; margin-top: 0.25rem;"><span style="font-weight: 700;">Lockhart Tactical</span> 7.62×39 CALIBER KIT</div>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; margin-top: -0.5rem;">
                                <span style="width: 20px; height: 20px; border-radius: 50%; background: #77C15A; display: inline-flex; align-items: center; justify-content: center;" title="Verfügbar">
                                    <svg viewBox="0 0 24 24" fill="none" style="width: 12px; height: 12px;"><path d="M5 13l4 4L19 7" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                </span>
                                <form action="{{ path('frontend.checkout.line-item.add') }}" method="post" data-form-csrf-handler="true">
                                    <input type="hidden" name="redirectTo" value="frontend.cart.offcanvas">
                                    <input type="hidden" name="lineItems[019ac3a775c771e992f10c480dc41ffd][id]" value="019ac3a775c771e992f10c480dc41ffd">
                                    <input type="hidden" name="lineItems[019ac3a775c771e992f10c480dc41ffd][quantity]" class="js-quantity-selector" value="1">
                                    <input type="hidden" name="lineItems[019ac3a775c771e992f10c480dc41ffd][type]" value="product">
                                    <input type="hidden" name="lineItems[019ac3a775c771e992f10c480dc41ffd][referencedId]" value="019ac3a775c771e992f10c480dc41ffd">
                                    <input type="hidden" name="lineItems[019ac3a775c771e992f10c480dc41ffd][stackable]" value="1">
                                    <input type="hidden" name="lineItems[019ac3a775c771e992f10c480dc41ffd][removable]" value="1">
                                    <button type="submit" style="width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; background: transparent; border: none; color: #374151; cursor: pointer;" title="In den Warenkorb">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" style="width: 24px; height: 24px;"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </article>

            </div>
        </div>
    </section>

    {# ========================================== #}
    {# CATEGORIES SECTION #}
    {# ========================================== #}
    <section class="raven-categories bg-white" style="padding: 3rem 0;">
        <div class="max-w-7xl mx-auto px-6 lg:px-24">
            <h2 style="font-family: 'Chakra Petch', sans-serif; font-size: clamp(2rem, 4vw, 3.5rem); font-weight: 400; color: #111827; line-height: 1.1; margin-bottom: 2rem;">
                Kategorien
            </h2>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;" class="md:!grid-cols-4">
                {# Category: Waffen #}
                {% set weaponCat = page.header.navigation.tree|first %}
                <a href="{% if weaponCat and weaponCat.category and weaponCat.category.id %}{{ seoUrl('frontend.navigation.page', { navigationId: weaponCat.category.id }) }}{% else %}{{ path('frontend.home.page') }}{% endif %}"
                   style="display: block; padding: 1.5rem 1rem; text-align: center; border: 1px solid #e5e7eb; border-radius: 0.75rem; background: white; text-decoration: none; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"
                   onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'; this.style.transform='translateY(-2px)';"
                   onmouseout="this.style.boxShadow='0 1px 2px rgba(0,0,0,0.05)'; this.style.transform='translateY(0)';">
                    <span style="display: inline-flex; width: 3.5rem; height: 3.5rem; align-items: center; justify-content: center; background: #f3f4f6; border-radius: 50%; margin-bottom: 1rem; color: #374151;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1.5rem; height: 1.5rem;">
                            <path d="M21 3h-4V2a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v1H3a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h1v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9h1a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zM4 5h3v2H4V5zm14 14H6V9h12v10zm2-12h-3V5h3v2z"/>
                        </svg>
                    </span>
                    <div style="font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Waffen</div>
                    <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.4;">Präzisionswaffen für jeden Einsatz</div>
                </a>

                {# Category: Munition #}
                <a href="{{ path('frontend.home.page') }}"
                   style="display: block; padding: 1.5rem 1rem; text-align: center; border: 1px solid #e5e7eb; border-radius: 0.75rem; background: white; text-decoration: none; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"
                   onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'; this.style.transform='translateY(-2px)';"
                   onmouseout="this.style.boxShadow='0 1px 2px rgba(0,0,0,0.05)'; this.style.transform='translateY(0)';">
                    <span style="display: inline-flex; width: 3.5rem; height: 3.5rem; align-items: center; justify-content: center; background: #f3f4f6; border-radius: 50%; margin-bottom: 1rem; color: #374151;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1.5rem; height: 1.5rem;">
                            <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="12" r="6" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="12" r="2" fill="currentColor"/>
                        </svg>
                    </span>
                    <div style="font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Munition</div>
                    <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.4;">Kaliber 9mm, .223, 7.62×39 & mehr</div>
                </a>

                {# Category: Waffenzubehör #}
                {% set caliberCat = page.header.navigation.tree|last %}
                <a href="{% if caliberCat and caliberCat.category and caliberCat.category.id %}{{ seoUrl('frontend.navigation.page', { navigationId: caliberCat.category.id }) }}{% else %}{{ path('frontend.home.page') }}{% endif %}"
                   style="display: block; padding: 1.5rem 1rem; text-align: center; border: 1px solid #e5e7eb; border-radius: 0.75rem; background: white; text-decoration: none; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"
                   onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'; this.style.transform='translateY(-2px)';"
                   onmouseout="this.style.boxShadow='0 1px 2px rgba(0,0,0,0.05)'; this.style.transform='translateY(0)';">
                    <span style="display: inline-flex; width: 3.5rem; height: 3.5rem; align-items: center; justify-content: center; background: #f3f4f6; border-radius: 50%; margin-bottom: 1rem; color: #374151;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1.5rem; height: 1.5rem;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
                            <path d="M12 6v6l4 2"/>
                            <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                            <line x1="12" y1="2" x2="12" y2="6" stroke="currentColor" stroke-width="2"/>
                            <line x1="12" y1="18" x2="12" y2="22" stroke="currentColor" stroke-width="2"/>
                            <line x1="2" y1="12" x2="6" y2="12" stroke="currentColor" stroke-width="2"/>
                            <line x1="18" y1="12" x2="22" y2="12" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </span>
                    <div style="font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Waffenzubehör</div>
                    <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.4;">Optiken, Magazine & Anbauteile</div>
                </a>

                {# Category: Ausrüstung #}
                <a href="{{ path('frontend.home.page') }}"
                   style="display: block; padding: 1.5rem 1rem; text-align: center; border: 1px solid #e5e7eb; border-radius: 0.75rem; background: white; text-decoration: none; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"
                   onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'; this.style.transform='translateY(-2px)';"
                   onmouseout="this.style.boxShadow='0 1px 2px rgba(0,0,0,0.05)'; this.style.transform='translateY(0)';">
                    <span style="display: inline-flex; width: 3.5rem; height: 3.5rem; align-items: center; justify-content: center; background: #f3f4f6; border-radius: 50%; margin-bottom: 1rem; color: #374151;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1.5rem; height: 1.5rem;">
                            <path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3zm6 9.09c0 4-2.55 7.7-6 8.83-3.45-1.13-6-4.82-6-8.83V6.31l6-2.25 6 2.25v4.78z"/>
                            <path d="M9.5 12l2 2 4-4"/>
                        </svg>
                    </span>
                    <div style="font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Ausrüstung</div>
                    <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.4;">Taktisches Zubehör & Schutzausrüstung</div>
                </a>
            </div>
        </div>
    </section>

    {# ========================================== #}
    {# BRANDS SECTION #}
    {# ========================================== #}
    <style>
        @media (min-width: 768px) {
            .raven-brands-grid { grid-template-columns: repeat(4, 1fr) !important; }
        }
    </style>
    <section class="raven-brands bg-white" style="padding: 3rem 0;">
        <div class="max-w-7xl mx-auto px-6 lg:px-24">
            <h2 style="font-family: 'Chakra Petch', sans-serif; font-size: clamp(2rem, 4vw, 3.5rem); font-weight: 400; color: #111827; line-height: 1.1; margin-bottom: 2rem;">
                Unsere Marken
            </h2>

            <div class="raven-brands-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                <div style="border: 1px solid #e5e7eb; border-radius: 0.75rem; height: 6rem; display: flex; align-items: center; justify-content: center; background: white; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"
                     onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'; this.style.transform='translateY(-2px)';"
                     onmouseout="this.style.boxShadow='0 1px 2px rgba(0,0,0,0.05)'; this.style.transform='translateY(0)';">
                    <img src="{{ asset('bundles/raventheme/assets/snigel logo.png') }}" alt="Snigel" style="max-height: 80%; max-width: 80%; object-fit: contain;">
                </div>
                <div style="border: 1px solid #e5e7eb; border-radius: 0.75rem; height: 6rem; display: flex; align-items: center; justify-content: center; background: white; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"
                     onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'; this.style.transform='translateY(-2px)';"
                     onmouseout="this.style.boxShadow='0 1px 2px rgba(0,0,0,0.05)'; this.style.transform='translateY(0)';">
                    <img src="{{ asset('bundles/raventheme/assets/zero tech logo.png') }}" alt="ZeroTech" style="max-height: 80%; max-width: 80%; object-fit: contain; transform: scale(1.3);">
                </div>
                <div style="border: 1px solid #e5e7eb; border-radius: 0.75rem; height: 6rem; display: flex; align-items: center; justify-content: center; background: white; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"
                     onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'; this.style.transform='translateY(-2px)';"
                     onmouseout="this.style.boxShadow='0 1px 2px rgba(0,0,0,0.05)'; this.style.transform='translateY(0)';">
                    <img src="{{ asset('bundles/raventheme/assets/magpul logo.png') }}" alt="Magpul" style="max-height: 80%; max-width: 80%; object-fit: contain; transform: scale(1.3);">
                </div>
                <div style="border: 1px solid #e5e7eb; border-radius: 0.75rem; height: 6rem; display: flex; align-items: center; justify-content: center; background: white; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"
                     onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'; this.style.transform='translateY(-2px)';"
                     onmouseout="this.style.boxShadow='0 1px 2px rgba(0,0,0,0.05)'; this.style.transform='translateY(0)';">
                    <img src="{{ asset('bundles/raventheme/assets/lockhart logo.png') }}" alt="Lockhart Tactical" style="max-height: 80%; max-width: 80%; object-fit: contain;">
                </div>
            </div>
        </div>
    </section>

    {# ========================================== #}
    {# VIDEO SECTION - 2 Columns: Video Left, Text Right #}
    {# ========================================== #}
    <style>
        @media (min-width: 768px) {
            .raven-video-grid { grid-template-columns: 1fr 1fr !important; }
        }
    </style>
    <section class="raven-video bg-white" style="padding: 3rem 0 4rem;">
        <div class="max-w-7xl mx-auto px-6 lg:px-24">
            <div class="raven-video-grid" style="display: grid; grid-template-columns: 1fr; gap: 2.5rem; align-items: center;">
                {# Video Embed - Cloudflare Stream (Left, smaller) #}
                <div style="border-radius: 0.75rem; overflow: hidden; position: relative; padding-top: 56.25%; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                    <iframe
                        src="https://customer-zz0gro70wkcharf0.cloudflarestream.com/14b22c52b620a8e2d65ba9eb5b481bdb/iframe?poster=https%3A%2F%2Fcustomer-zz0gro70wkcharf0.cloudflarestream.com%2F14b22c52b620a8e2d65ba9eb5b481bdb%2Fthumbnails%2Fthumbnail.jpg%3Ftime%3D%26height%3D600"
                        loading="lazy"
                        style="border: none; position: absolute; top: 0; left: 0; height: 100%; width: 100%;"
                        allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
                        allowfullscreen="true"
                    ></iframe>
                </div>

                {# Video Description (Right) #}
                <div>
                    <h2 style="font-family: 'Chakra Petch', sans-serif; font-size: clamp(1.75rem, 3vw, 2.5rem); font-weight: 400; color: #111827; margin-bottom: 1rem;">
                        Video und Informationen
                    </h2>
                    <p style="color: #4B5563; line-height: 1.7; margin-bottom: 1.25rem; font-size: 1rem;">
                        Fügen Sie hier einen kurzen, klaren Beschreibungstext ein und integrieren Sie relevante Keywords, um Ihre Sichtbarkeit bei Google zu verbessern.
                    </p>
                    <ul style="color: #374151; list-style-type: none; padding-left: 0;">
                        <li style="margin-bottom: 0.75rem; display: flex; align-items: flex-start; gap: 0.75rem;">
                            <span style="color: #D4A847; font-weight: 600;">•</span>
                            <span>Keyword 1 – Nutzenpunkt</span>
                        </li>
                        <li style="margin-bottom: 0.75rem; display: flex; align-items: flex-start; gap: 0.75rem;">
                            <span style="color: #D4A847; font-weight: 600;">•</span>
                            <span>Keyword 2 – Nutzenpunkt</span>
                        </li>
                        <li style="margin-bottom: 0.75rem; display: flex; align-items: flex-start; gap: 0.75rem;">
                            <span style="color: #D4A847; font-weight: 600;">•</span>
                            <span>Keyword 3 – Nutzenpunkt</span>
                        </li>
                        <li style="margin-bottom: 0.75rem; display: flex; align-items: flex-start; gap: 0.75rem;">
                            <span style="color: #D4A847; font-weight: 600;">•</span>
                            <span>Keyword 4 – Nutzenpunkt</span>
                        </li>
                        <li style="display: flex; align-items: flex-start; gap: 0.75rem;">
                            <span style="color: #D4A847; font-weight: 600;">•</span>
                            <span>Keyword 5 – Nutzenpunkt</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

</main>

{# Raven Cart AJAX Handler - Intercepts cart operations to stay in sidebar #}
<script>
(function() {
    'use strict';

    // Direct offcanvas cart opener - doesn't rely on Shopware's plugin
    function openOffcanvasCart() {
        fetch('/checkout/offcanvas', {
            method: 'GET',
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(function(response) { return response.text(); })
        .then(function(html) {
            var offcanvas = document.getElementById('raven-offcanvas-cart');
            if (!offcanvas) {
                offcanvas = document.createElement('div');
                offcanvas.id = 'raven-offcanvas-cart';
                offcanvas.className = 'offcanvas offcanvas-end';
                var isMobile = window.innerWidth <= 480;
                offcanvas.style.cssText = 'position:fixed;top:0;right:0;bottom:0;width:' + (isMobile ? '100%' : '420px') + ';max-width:100vw;z-index:1050;background:#fff;transform:translateX(100%);transition:transform 0.3s ease;box-shadow:-4px 0 15px rgba(0,0,0,0.1);';
                document.body.appendChild(offcanvas);
            }
            offcanvas.innerHTML = '<div class="offcanvas-body p-0">' + html + '</div>';
            offcanvas.style.transform = 'translateX(0)';
            offcanvas.classList.add('show');

            // Create backdrop
            var backdrop = document.getElementById('raven-offcanvas-backdrop');
            if (!backdrop) {
                backdrop = document.createElement('div');
                backdrop.id = 'raven-offcanvas-backdrop';
                backdrop.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1040;opacity:0;transition:opacity 0.15s;';
                backdrop.onclick = closeOffcanvasCart;
                document.body.appendChild(backdrop);
            }
            setTimeout(function() { backdrop.style.opacity = '1'; }, 10);
            document.body.style.overflow = 'hidden';

            // Attach close handlers to any close buttons in the cart
            offcanvas.querySelectorAll('[data-offcanvas-close], .js-offcanvas-close, .raven-cart-close').forEach(function(btn) {
                btn.onclick = function(e) {
                    e.preventDefault();
                    closeOffcanvasCart();
                };
            });
        });
    }

    function closeOffcanvasCart() {
        var offcanvas = document.getElementById('raven-offcanvas-cart');
        var backdrop = document.getElementById('raven-offcanvas-backdrop');
        if (offcanvas) {
            offcanvas.style.transform = 'translateX(100%)';
            offcanvas.classList.remove('show');
        }
        if (backdrop) {
            backdrop.style.opacity = '0';
            setTimeout(function() { backdrop.remove(); }, 150);
        }
        document.body.style.overflow = '';
    }

    function refreshOffcanvasCart() {
        var offcanvas = document.getElementById('raven-offcanvas-cart');
        if (offcanvas && offcanvas.classList.contains('show')) {
            fetch('/checkout/offcanvas', {
                method: 'GET',
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(function(response) { return response.text(); })
            .then(function(html) {
                offcanvas.innerHTML = '<div class="offcanvas-body p-0">' + html + '</div>';
                // Re-attach close handlers
                offcanvas.querySelectorAll('[data-offcanvas-close], .js-offcanvas-close, .raven-cart-close').forEach(function(btn) {
                    btn.onclick = function(e) {
                        e.preventDefault();
                        closeOffcanvasCart();
                    };
                });
            });
        }
    }

    function submitCartFormAjax(form) {
        var formData = new FormData(form);
        var action = form.getAttribute('action');
        fetch(action, {
            method: 'POST',
            body: formData,
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(function() { refreshOffcanvasCart(); })
        .catch(function() { refreshOffcanvasCart(); });
    }

    // Intercept ALL form submissions using capture phase
    document.addEventListener('submit', function(e) {
        var form = e.target;
        var action = form.getAttribute('action');
        if (!action) return;

        if (action.indexOf('checkout/line-item/delete') !== -1 ||
            action.indexOf('checkout/line-item/change-quantity') !== -1) {
            e.preventDefault();
            e.stopImmediatePropagation();
            submitCartFormAjax(form);
            return false;
        }

        if (action.indexOf('checkout/line-item/add') !== -1) {
            e.preventDefault();
            e.stopImmediatePropagation();
            var formData = new FormData(form);
            fetch(action, {
                method: 'POST',
                body: formData,
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            }).then(function() {
                // Directly open our custom offcanvas cart
                openOffcanvasCart();
            });
            return false;
        }
    }, true);

    // Handle quantity and delete button clicks
    document.addEventListener('click', function(e) {
        var minusBtn = e.target.closest('.js-btn-minus');
        if (minusBtn) {
            e.preventDefault();
            e.stopImmediatePropagation();
            var form = minusBtn.closest('form');
            var input = form ? form.querySelector('input[name="quantity"]') : null;
            if (input) {
                var current = parseInt(input.value) || 1;
                if (current > 1) {
                    input.value = current - 1;
                    submitCartFormAjax(form);
                }
            }
            return;
        }

        var plusBtn = e.target.closest('.js-btn-plus');
        if (plusBtn) {
            e.preventDefault();
            e.stopImmediatePropagation();
            var form = plusBtn.closest('form');
            var input = form ? form.querySelector('input[name="quantity"]') : null;
            if (input) {
                var current = parseInt(input.value) || 1;
                input.value = current + 1;
                submitCartFormAjax(form);
            }
            return;
        }

        var removeBtn = e.target.closest('.raven-item-remove');
        if (removeBtn) {
            e.preventDefault();
            e.stopImmediatePropagation();
            var form = removeBtn.closest('form');
            if (form) submitCartFormAjax(form);
            return;
        }

        // Intercept cart button clicks to use our custom offcanvas
        var cartBtn = e.target.closest('[data-offcanvas-cart]');
        if (cartBtn) {
            e.preventDefault();
            e.stopImmediatePropagation();
            openOffcanvasCart();
            return;
        }
    }, true);

    // Auto-dismiss Shopware alert messages after 3 seconds
    function autoDismissAlerts() {
        var alerts = document.querySelectorAll('.alert, [role="alert"]');
        alerts.forEach(function(alert) {
            if (!alert.dataset.ravenDismissed) {
                alert.dataset.ravenDismissed = 'true';
                setTimeout(function() {
                    alert.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    alert.style.opacity = '0';
                    alert.style.transform = 'translateY(-20px)';
                    setTimeout(function() {
                        alert.style.display = 'none';
                    }, 300);
                }, 3000);
            }
        });
    }

    // Run on page load and after DOM changes
    document.addEventListener('DOMContentLoaded', autoDismissAlerts);

    // Also watch for dynamically added alerts
    var alertObserver = new MutationObserver(function(mutations) {
        autoDismissAlerts();
    });
    alertObserver.observe(document.body, { childList: true, subtree: true });

    // Expose global functions
    window.ravenOpenCart = openOffcanvasCart;
    window.ravenCloseCart = closeOffcanvasCart;
    window.ravenRefreshCart = refreshOffcanvasCart;
    console.log('Raven Cart AJAX handler loaded with custom offcanvas');
})();
</script>

{% else %}
    {# For non-homepage pages, use default Shopware rendering #}
    {{ parent() }}
{% endif %}
{% endblock %}

