<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <service id="RavenTheme\Controller\LegalPagesController" public="true">
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <service id="RavenTheme\Controller\ManufacturerPageController" public="true">
            <argument type="service" id="product_manufacturer.repository"/>
            <argument type="service" id="sales_channel.product.repository"/>
            <argument type="service" id="category.repository"/>
            <argument type="service" id="Shopware\Storefront\Page\GenericPageLoader"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <!-- Navigation Products Subscriber - loads products for dropdown menu -->
        <service id="RavenTheme\Subscriber\NavigationProductsSubscriber">
            <argument type="service" id="sales_channel.product.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Homepage Products Subscriber - loads featured products for homepage -->
        <service id="RavenTheme\Subscriber\HomepageProductsSubscriber">
            <argument type="service" id="sales_channel.product.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Product Detail Subscriber - loads seoCategory for breadcrumb -->
        <service id="RavenTheme\Subscriber\ProductDetailSubscriber">
            <argument type="service" id="main_category.repository"/>
            <argument type="service" id="category.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Cart Line Item Subscriber - saves selected color to line item -->
        <service id="RavenTheme\Subscriber\CartLineItemSubscriber">
            <argument type="service" id="request_stack"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Redirect Cleanup Subscriber - removes _noStore from redirectParameters to prevent Cloudflare 403 -->
        <service id="RavenTheme\Subscriber\RedirectCleanupSubscriber">
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Logout Redirect Subscriber - redirects to homepage after logout -->
        <service id="RavenTheme\Subscriber\LogoutRedirectSubscriber">
            <argument type="service" id="router"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Login Redirect Subscriber - redirects to checkout after login if cart has items -->
        <service id="RavenTheme\Subscriber\LoginRedirectSubscriber">
            <argument type="service" id="router"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\SalesChannel\CartService"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Variant Price Processor - overrides line item prices for Snigel variants -->
        <service id="RavenTheme\Cart\VariantPriceProcessor">
            <argument type="service" id="Shopware\Core\Checkout\Cart\Price\QuantityPriceCalculator"/>
            <tag name="shopware.cart.processor" priority="4000"/>
        </service>

        <!-- Order Notification Subscriber - sends email to admin on new orders -->
        <service id="RavenTheme\Subscriber\OrderNotificationSubscriber">
            <argument type="service" id="mailer"/>
            <argument type="service" id="logger"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Bank Transfer Email Subscriber - sends payment info email to customers -->
        <service id="RavenTheme\Subscriber\BankTransferEmailSubscriber">
            <argument type="service" id="mailer"/>
            <argument type="service" id="logger"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Turnstile Validation Subscriber - validates Cloudflare Turnstile on registration/login -->
        <service id="RavenTheme\Subscriber\TurnstileValidationSubscriber">
            <argument type="service" id="request_stack"/>
            <argument type="service" id="router"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Shipping Delivery Time Subscriber - loads delivery time for shipping methods on checkout -->
        <service id="RavenTheme\Subscriber\ShippingDeliveryTimeSubscriber">
            <argument type="service" id="shipping_method.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Review Auto-Approve Subscriber - auto-approves 4-5 star reviews -->
        <service id="RavenTheme\Subscriber\ReviewAutoApproveSubscriber">
            <argument type="service" id="product_review.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Product Reviews Subscriber - loads reviews on product detail page -->
        <service id="RavenTheme\Subscriber\ProductReviewsSubscriber">
            <argument type="service" id="product_review.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>
    </services>

</container>
