<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RAVEN WEAPON AG - Warenkorb</title>

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

    <!-- Styles -->
    <link rel="stylesheet" href="style.css" />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "ui-sans-serif", "system-ui"],
            },
            colors: {
              brand: {
                yellow: "#F2C200",
                dark: "#0B0F14",
                navy: "#1E2A36",
                gray: "#6B7280",
              },
            },
            boxShadow: {
              header: "0 2px 12px rgba(0,0,0,0.12)",
            },
          },
          container: {
            center: true,
            padding: { DEFAULT: "1rem", lg: "2rem", xl: "2.5rem", "2xl": "3rem" },
          },
        },
      };
    </script>
    <style>
      /* Product price styling */
      .price {
        font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans';
        color: #E53935;
        font-weight: 600;
        font-size: 16px;
        line-height: 1.2;
        letter-spacing: 0;
      }
      .nav-text { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans'; }
    </style>
  </head>

  <body class="bg-white text-gray-900 antialiased font-sans">
    <!-- Header (mobile) -->
    <header class="bg-white relative z-50 md:hidden">
      <div class="max-w-7xl mx-auto px-6 lg:px-24 py-[10px]">
        <div class="flex items-center justify-between h-[52px]">
          <div class="flex items-center gap-3">
            <a href="index.html" class="inline-flex items-center h-10 w-[182px]" aria-label="Raven Weapon home">
              <div class="bg-left bg-no-repeat h-10 w-[182px]" style="background-image:url('assets/raven-logo-bold (1)-stroke-and-fill.svg');background-size:100% 455%"></div>
            </a>
          </div>
          <div class="flex items-center gap-2">
            <!-- User icon linking to account page -->
            <a href="account.html" class="relative inline-flex items-center justify-center h-[38px] w-[38px] rounded-md border border-gray-300 text-gray-600 hover:bg-gray-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300" aria-label="Benutzer">
              <i class="fa-solid fa-user text-[16px]"></i>
            </a>
            <!-- Cart icon -->
            <button type="button" id="cart-btn-mobile" class="relative inline-flex items-center justify-center h-[38px] w-[38px] rounded-md border border-gray-300 text-gray-600 hover:bg-gray-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300" aria-label="Warenkorb">
              <svg class="h-4 w-4" viewBox="0 0 640 640" fill="currentColor" aria-hidden="true"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
              <span class="cart-count absolute -top-2 -right-2 bg-gradient-to-r from-yellow-300 via-amber-400 to-yellow-500 text-black text-[10px] leading-none w-5 h-5 rounded-full flex items-center justify-center font-bold shadow-sm" style="display: none;">0</span>
            </button>
            <button id="mobile-menu-toggle" class="md:hidden inline-flex items-center justify-center h-[38px] w-[38px] rounded-md text-gray-600 hover:bg-gray-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300" aria-label="Menü">
              <svg id="hamburger-icon" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
              </svg>
              <svg id="close-icon" class="hidden h-6 w-6 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Desktop header -->
    <div class="hidden md:block bg-white border-b border-gray-200 pt-3">
      <div class="max-w-7xl mx-auto px-6 lg:px-24">
        <div class="flex items-center justify-between h-[52px] py-[10px]">
          <div class="flex items-center">
            <a href="index.html" class="inline-flex items-center h-10 w-[222px]" aria-label="Raven Weapon home">
              <div class="bg-left bg-no-repeat h-10 w-[182px]" style="background-image:url('assets/raven-logo-bold (1)-stroke-and-fill.svg');background-size:100% 455%"></div>
            </a>
          </div>
          <div class="relative w-[300px] h-9">
            <input type="search" placeholder="Suche" class="nav-text w-full h-full rounded-full bg-[rgba(120,120,128,0.16)] pl-9 pr-3 text-[17px] leading-[22px] text-[#111827] placeholder-gray-500/80 outline-none focus:ring-2 focus:ring-gray-300"/>
            <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
          </div>
          <div class="flex items-center gap-2">
            <!-- User icon linking to account page -->
            <a href="account.html" class="relative inline-flex items-center justify-center h-[38px] w-[38px] rounded-md border border-gray-300 text-gray-600 hover:bg-gray-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300" aria-label="Benutzer">
              <i class="fa-solid fa-user text-[16px]"></i>
            </a>
            <!-- Cart icon -->
            <button type="button" id="cart-btn-desktop" class="relative inline-flex items-center justify-center h-[38px] w-[38px] rounded-md border border-gray-300 text-gray-600 hover:bg-gray-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300" aria-label="Warenkorb">
              <svg class="h-4 w-4" viewBox="0 0 640 640" fill="currentColor" aria-hidden="true"><path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L524.7 96C549.8 96 568.7 118.9 564 143.6L537.6 280.6C529.6 322 493.4 352 451.2 352L171.4 352L176.5 380.3C178.6 391.7 188.5 400 200.1 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM162.6 304L451.2 304C470.4 304 486.9 290.4 490.5 271.6L514.9 144L133.5 144L162.6 304zM208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528C160 501.5 181.5 480 208 480zM432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528C384 501.5 405.5 480 432 480z"/></svg>
              <span class="cart-count absolute -top-2 -right-2 bg-gradient-to-r from-yellow-300 via-amber-400 to-yellow-500 text-black text-[10px] leading-none w-5 h-5 rounded-full flex items-center justify-center font-bold shadow-sm" style="display: none;">0</span>
            </button>
          </div>
        </div>
        <div class="pb-2">
          <nav class="nav-text flex items-center justify-center gap-5">
            <a href="index.html" class="group relative inline-flex items-center text-sm font-medium text-black py-2 pr-5">Startseite</a>
            <a href="shop/category/weapon.html" class="group inline-flex items-center gap-2 text-sm font-medium text-gray-700 hover:text-gray-900 py-2 pr-5">Waffen
              <svg class="h-4 w-4 text-gray-500 group-hover:text-gray-700" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z" clip-rule="evenodd"/></svg>
            </a>
            <a href="#" class="group inline-flex items-center gap-2 text-sm font-medium text-slate-700 hover:text-gray-900 py-2 pr-5">Waffenzubehör
              <svg class="h-4 w-4 text-gray-500 group-hover:text-gray-700" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z" clip-rule="evenodd"/></svg>
            </a>
            <a href="shop/category/ammunition.html" class="group inline-flex items-center gap-2 text-sm font-medium text-slate-700 hover:text-gray-900 py-2 pr-5">Munition
              <svg class="h-4 w-4 text-gray-500 group-hover:text-gray-700" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z" clip-rule="evenodd"/></svg>
            </a>
            <a href="#" class="group inline-flex items-center gap-2 text-sm font-medium text-slate-700 hover:text-gray-900 py-2 pr-5">Ausrüstung
              <svg class="h-4 w-4 text-gray-500 group-hover:text-gray-700" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z" clip-rule="evenodd"/></svg>
            </a>
            <a href="#" class="group relative inline-flex items-center text-sm font-medium text-slate-700 hover:text-gray-900 py-2 pr-5">Über uns</a>
            <a href="#" class="group relative inline-flex items-center text-sm font-medium text-slate-700 hover:text-gray-900 py-2 pr-5">Kontakt</a>
          </nav>
        </div>
      </div>
    </div>

    <!-- Mobile search bar -->
    <div class="md:hidden bg-white border-b border-gray-200 px-6 py-3">
      <div class="relative">
        <input type="search" placeholder="Suche" class="nav-text w-full h-9 rounded-full bg-[rgba(120,120,128,0.16)] pl-10 pr-4 text-[17px] leading-[22px] text-[#111827] placeholder-gray-500/80 outline-none focus:ring-2 focus:ring-gray-300"/>
        <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      </div>
    </div>

    <!-- Mobile navigation overlay -->
    <div id="mobile-menu" class="hidden fixed top-[72px] left-0 right-0 bottom-0 bg-white z-30 md:hidden shadow-lg">
      <nav class="nav-text px-4 py-6">
        <div class="space-y-4">
          <a href="index.html" class="block text-lg font-medium text-black py-3 border-b border-gray-100">Startseite</a>
          <a href="shop/category/weapon.html" class="flex items-center justify-between text-lg font-medium text-gray-700 hover:text-gray-900 py-3 border-b border-gray-100">
            Waffen
            <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z" clip-rule="evenodd"/>
            </svg>
          </a>
          <a href="#" class="flex items-center justify-between text-lg font-medium text-gray-700 hover:text-gray-900 py-3 border-b border-gray-100">
            Waffenzubehör
            <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z" clip-rule="evenodd"/>
            </svg>
          </a>
          <a href="shop/category/ammunition.html" class="flex items-center justify-between text-lg font-medium text-gray-700 hover:text-gray-900 py-3 border-b border-gray-100">
            Munition
            <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z" clip-rule="evenodd"/>
            </svg>
          </a>
          <a href="#" class="flex items-center justify-between text-lg font-medium text-gray-700 hover:text-gray-900 py-3 border-b border-gray-100">
            Ausrüstung
            <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z" clip-rule="evenodd"/>
            </svg>
          </a>
          <a href="#" class="block text-lg font-medium text-gray-700 hover:text-gray-900 py-3 border-b border-gray-100">Über uns</a>
          <a href="#" class="block text-lg font-medium text-gray-700 hover:text-gray-900 py-3">Kontakt</a>
        </div>
      </nav>
    </div>

    <!-- Main cart section -->
    <section id="warenkorb" class="container py-12 md:py-16">
      <!-- Cart header row: title and free-shipping banner -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between">
        <h1 class="text-3xl md:text-4xl font-bold mb-2" style="font-family:'Chakra Petch',sans-serif;">Ihr Warenkorb</h1>
        <div id="shipping-banner" class="text-sm md:text-base text-gray-700 md:text-right"></div>
      </div>
      <!-- Cart table -->
      <div class="mt-4 border-t border-gray-200">
        <!-- Header row -->
        <div class="hidden md:grid grid-cols-3 gap-4 py-2 uppercase text-sm font-semibold text-gray-700">
          <span>Produkt</span>
          <span class="text-center">Anzahl</span>
          <span class="text-right">Summe</span>
        </div>
        <!-- Dynamic product rows will be injected here -->
        <div id="cart-rows"></div>
        <!-- Empty state (page) -->
        <div id="cart-empty-page" class="hidden text-center py-16">
          <svg class="w-24 h-24 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
          </svg>
          <p class="text-gray-700 text-lg font-medium">Ihr Warenkorb ist leer</p>
          <p class="text-gray-500 text-sm mt-2">Fügen Sie Produkte hinzu, um fortzufahren</p>
          <a href="shop/index.html" class="mt-6 inline-flex items-center justify-center px-5 py-2.5 rounded-lg font-semibold text-black shadow-md hover:brightness-95 transition-all"
             style="background:linear-gradient(to right, #F2B90D 12%, #F6CE55 88%);">
            Weiter einkaufen
          </a>
        </div>
      </div>
      <!-- Summary section -->
      <div class="mt-8 border-t border-gray-200 pt-6">
        <div class="flex flex-col gap-4">
          <!-- Price breakdown -->
          <div class="space-y-2 max-w-md ml-auto">
            <div class="flex items-center justify-between text-gray-700">
              <span>Zwischensumme</span>
              <span id="cart-subtotal" class="font-medium">CHF 0.00</span>
            </div>
            <div class="flex items-center justify-between text-gray-700">
              <span>MwSt. <span id="cart-tax-rate" class="text-sm">(8.1%)</span></span>
              <span id="cart-tax" class="font-medium">CHF 0.00</span>
            </div>
            <div class="flex items-center justify-between text-lg font-bold text-gray-900 pt-2 border-t border-gray-200">
              <span>Gesamtsumme</span>
              <span id="cart-total-with-tax" class="text-xl">CHF 0.00</span>
            </div>
            <p class="text-sm text-gray-600 mt-2">Versandkosten werden an der Kasse berechnet.</p>
          </div>
          <!-- Checkout button -->
          <div class="flex justify-end">
            <button onclick="proceedToCheckout()" class="inline-flex items-center justify-center px-6 py-3 rounded-lg font-semibold text-black shadow-md hover:brightness-95 transition-all"
               style="background:linear-gradient(to right, #F2B90D 12%, #F6CE55 88%);">
              Zur&nbsp;Kasse
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-12 border-t border-gray-200 bg-white">
      <!-- Feature highlights -->
      <div class="container py-8">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="flex items-start gap-3 rounded-md border border-gray-200 bg-white p-4">
            <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-red-600 text-white overflow-hidden">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="w-full h-full" aria-hidden="true">
                <rect width="32" height="32" fill="#FF0000"/>
                <path d="M13 6h6v7h7v6h-7v7h-6v-7H6v-6h7V6z" fill="white"/>
              </svg>
            </span>
            <div class="nav-text">
              <div class="font-semibold text-gray-900">Schweizer Qualität</div>
              <div class="text-sm text-gray-600">Produktion in Luzern</div>
            </div>
          </div>
          <div class="flex items-start gap-3 rounded-md border border-gray-200 bg-white p-4">
            <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-gray-800 text-white"><i class="fa-solid fa-tags"></i></span>
            <div class="nav-text">
              <div class="font-semibold text-gray-900">Beste Preise</div>
              <div class="text-sm text-gray-600">Direktverkauf = tiefe Preise</div>
            </div>
          </div>
          <div class="flex items-start gap-3 rounded-md border border-gray-200 bg-white p-4">
            <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-gray-800 text-white"><i class="fa-solid fa-truck-fast"></i></span>
            <div class="nav-text">
              <div class="font-semibold text-gray-900">Versand heute</div>
              <div class="text-sm text-gray-600">Mo–Fr, bis 19:20 Uhr bestellt</div>
            </div>
          </div>
          <div class="flex items-start gap-3 rounded-md border border-gray-200 bg-white p-4">
            <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-gray-800 text-white"><i class="fa-solid fa-phone"></i></span>
            <div class="nav-text">
              <div class="font-semibold text-gray-900">+41 79 356 19 86</div>
              <div class="text-sm text-gray-600">frei, freundlich, kompetent</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Newsletter gold bar -->
      <div class="bg-gradient-to-r from-yellow-300 via-amber-400 to-yellow-500">
        <div class="container py-6 md:py-8">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div class="flex items-center gap-3">
              <span class="inline-flex h-10 w-10 items-center justify-center rounded-md bg-black/70 text-white"><i class="fa-solid fa-envelope"></i></span>
              <div>
                <div class="text-xl md:text-2xl font-semibold text-black" style="font-family:'Chakra Petch',sans-serif;">Newsletter</div>
                <div class="nav-text text-black/80 text-sm">Jetzt anmelden und profitieren</div>
              </div>
            </div>
            <form class="w-full md:w-auto">
              <div class="flex rounded-md overflow-hidden shadow-sm">
                <input type="email" placeholder="Ihre E-Mail" class="nav-text w-full md:w-[420px] px-4 py-2 text-gray-900 placeholder-gray-600 bg-white outline-none"/>
                <button type="submit" class="nav-text px-4 md:px-6 py-2 bg-black text-white font-semibold">Abonnieren</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Footer links -->
      <div class="container py-10">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
          <div>
            <h3 class="text-sm font-semibold text-gray-900 tracking-wide mb-3">DIE MARKE</h3>
            <p class="nav-text text-gray-700 text-sm">RAVEN WEAPON AG</p>
            <p class="nav-text text-gray-700 text-sm mt-2">Höchste Qualität</p>
          </div>
          <div>
            <h3 class="text-sm font-semibold text-gray-900 tracking-wide mb-3">DAS UNTERNEHMEN</h3>
            <ul class="nav-text text-sm text-gray-700 space-y-1">
              <li>Raven Weapon AG</li>
              <li>Sunnenbergstrasse 2</li>
              <li>8633 Wolfhausen</li>
              <li><a href="mailto:info@ravenweapon.ch" class="hover:text-gray-900">info@ravenweapon.ch</a></li>
              <li><a href="tel:+41793561986" class="hover:text-gray-900">+41 79 356 19 86</a></li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold text-gray-900 tracking-wide mb-3">NÜTZLICHE LINKS</h3>
            <ul class="nav-text text-sm text-gray-700 space-y-2">
              <li><a href="#kontakt" class="hover:text-gray-900">Kontakt</a></li>
              <li><a href="#versand" class="hover:text-gray-900">Versand</a></li>
              <li><a href="#faq" class="hover:text-gray-900">FAQ</a></li>
              <li><a href="#agb" class="hover:text-gray-900">AGB</a></li>
              <li><a href="impressum.html" class="hover:text-gray-900">Impressum</a></li>
              <li><a href="datenschutz.html" class="hover:text-gray-900">Datenschutzerklärung</a></li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold text-gray-900 tracking-wide mb-3">BELIEBTE KATEGORIEN</h3>
            <ul class="nav-text text-sm text-gray-700 space-y-2">
              <li><a href="shop/category/weapon.html" class="hover:text-gray-900">Waffen</a></li>
              <li><a href="shop/index.html" class="hover:text-gray-900">Zubehör</a></li>
              <li><a href="shop/category/ammunition.html" class="hover:text-gray-900">Munition</a></li>
              <li><a href="shop/index.html" class="hover:text-gray-900">Ausrüstung</a></li>
            </ul>
          </div>
        </div>
        <div class="mt-6 flex items-center gap-4 text-gray-600">
          <a href="#" aria-label="Instagram" class="h-9 w-9 inline-flex items-center justify-center rounded-full border border-gray-300 hover:bg-gray-100"><i class="fa-brands fa-instagram"></i></a>
          <a href="#" aria-label="YouTube" class="h-9 w-9 inline-flex items-center justify-center rounded-full border border-gray-300 hover:bg-gray-100"><i class="fa-brands fa-youtube"></i></a>
          <a href="#" aria-label="WhatsApp" class="h-9 w-9 inline-flex items-center justify-center rounded-full border border-gray-300 hover:bg-gray-100"><i class="fa-brands fa-whatsapp"></i></a>
        </div>
      </div>
      <div class="border-t border-gray-200">
        <div class="nav-text container py-6 text-sm text-gray-500 text-center">
          © 2025 RAVEN WEAPON AG. Alle Rechte vorbehalten.
        </div>
      </div>
    </footer>

    <!-- Cart Sidebar (optional, left as-is for future use) -->
    <div id="cart-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[100] transition-opacity duration-300"></div>
    <aside id="cart-sidebar" class="fixed top-0 right-0 h-full w-full sm:w-[400px] bg-white shadow-2xl z-[101] transform translate-x-full transition-transform duration-300 ease-in-out flex flex-col">
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <h2 class="text-xl font-bold text-gray-900">Warenkorb</h2>
        <button id="close-cart" class="p-2 hover:bg-gray-100 rounded-md transition-colors" aria-label="Schließen">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="flex-1 overflow-y-auto p-6">
        <div id="shipping-message" class="text-sm text-gray-600 mb-4"></div>
        <div id="cart-empty" class="hidden text-center py-12">
          <svg class="w-24 h-24 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
          </svg>
          <p class="text-gray-500 text-lg font-medium">Ihr Warenkorb ist leer</p>
          <p class="text-gray-400 text-sm mt-2">Fügen Sie Produkte hinzu, um fortzufahren</p>
        </div>
        <div id="cart-content" class="hidden">
          <div id="cart-items" class="space-y-0"></div>
        </div>
      </div>
      <div id="cart-footer" class="border-t border-gray-200 p-6 bg-gray-50">
        <div class="space-y-2 mb-4">
          <div class="flex items-center justify-between text-sm text-gray-700">
            <span>Zwischensumme</span>
            <span id="sidebar-subtotal">CHF 0.00</span>
          </div>
          <div class="flex items-center justify-between text-sm text-gray-700">
            <span>MwSt. (8.1%)</span>
            <span id="sidebar-tax">CHF 0.00</span>
          </div>
          <div class="flex items-center justify-between pt-2 border-t border-gray-200">
            <span class="text-lg font-semibold text-gray-900">Gesamtsumme</span>
            <span id="cart-total" class="text-2xl font-bold text-gray-900">CHF 0.00</span>
          </div>
        </div>
        <div class="space-y-3">
          <div class="grid grid-cols-2 gap-3">
            <button onclick="cart.viewCart()" class="border border-gray-300 text-gray-700 font-semibold py-3 rounded-lg hover:bg-gray-100 transition-colors">
              Warenkorb ansehen
            </button>
            <button onclick="proceedToCheckout()" class="bg-gradient-to-r from-yellow-300 via-amber-400 to-yellow-500 text-black font-semibold py-3 rounded-lg hover:brightness-95 transition-all shadow-md flex items-center justify-center gap-2">
              Zur Kasse
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- External scripts -->
    <script src="auth/js/auth.js"></script>
    <script src="cart.js?v=2"></script>
    <script src="search.js"></script>
    <script src="script.js"></script>

    <!-- Checkout authentication check -->
    <script>
      // Check authentication before allowing checkout
      function proceedToCheckout() {
        // Wait for auth system to be ready
        const checkAndProceed = () => {
          if (!window.authSystem) {
            // Auth system not loaded yet, wait a bit
            setTimeout(checkAndProceed, 100);
            return;
          }

          // Check if user is logged in
          if (!window.authSystem.isLoggedIn()) {
            console.log('[Cart] User not logged in, redirecting to login before checkout');
            // Redirect to login with return URL
            window.location.href = 'login.html?redirect=checkout.html';
          } else {
            console.log('[Cart] User authenticated, proceeding to checkout');
            // User is logged in, go to checkout
            window.location.href = 'checkout.html';
          }
        };

        checkAndProceed();
      }
    </script>

    <!-- Page logic: hydrate cart from localStorage and render -->
    <script>
      (function () {
        const STORAGE_KEYS = ['raven_cart', 'rw_cart', 'cart', 'ravenweapon_cart'];
        const FREE_SHIPPING_THRESHOLD_CHF = 59;
        const VAT_RATE = 0.081; // 8.1% Swiss VAT

        const $rows = document.getElementById('cart-rows');
        const $subtotal = document.getElementById('cart-subtotal');
        const $tax = document.getElementById('cart-tax');
        const $taxRate = document.getElementById('cart-tax-rate');
        const $totalWithTax = document.getElementById('cart-total-with-tax');
        const $banner = document.getElementById('shipping-banner');
        const $emptyPage = document.getElementById('cart-empty-page');
        const headerBubbles = document.querySelectorAll('.cart-count');

        // ---- helpers ----
        const chf = new Intl.NumberFormat('de-CH', { style: 'currency', currency: 'CHF' });
        const fmtCHF = v => chf.format(Math.max(0, Number(v) || 0));

        function parsePriceToNumber(p) {
          if (typeof p === 'number') return p;
          if (!p) return 0;
          // Accept "CHF 2.30", "2,30", "2.30", etc.
          const cleaned = String(p).replace(/[^\d,.\-]/g, '').replace(',', '.');
          const n = parseFloat(cleaned);
          return isNaN(n) ? 0 : n;
        }

        function readCart() {
          for (const key of STORAGE_KEYS) {
            try {
              const raw = localStorage.getItem(key);
              if (!raw) continue;
              const arr = JSON.parse(raw);
              if (Array.isArray(arr)) return { key, items: arr };
            } catch (e) { /* ignore */ }
          }
          return { key: STORAGE_KEYS[0], items: [] };
        }

        function writeCart(items) {
          const payload = JSON.stringify(items);
          // mirror to all keys for compatibility across pages/scripts
          STORAGE_KEYS.forEach(k => localStorage.setItem(k, payload));
          // ping global cart (if site-wide object exists)
          if (window.cart && typeof window.cart.refresh === 'function') {
            try { window.cart.refresh(); } catch(e) {}
          }
        }

        function totalQty(items) {
          return items.reduce((s, it) => s + (Number(it.quantity) || 0), 0);
        }

        function subtotalCHF(items) {
          return items.reduce((s, it) => {
            const price = parsePriceToNumber(it.price);
            const qty = Number(it.quantity) || 0;
            return s + price * qty;
          }, 0);
        }

        function updateHeaderBubbles(qty) {
          headerBubbles.forEach(b => {
            if (qty > 0) {
              b.style.display = '';
              b.textContent = String(qty);
            } else {
              b.style.display = 'none';
              b.textContent = '0';
            }
          });
        }

        function renderBanner(sub) {
          const remaining = Math.max(0, FREE_SHIPPING_THRESHOLD_CHF - sub);
          if (remaining > 0) {
            $banner.innerHTML = `Nur ${fmtCHF(remaining)} mehr, um kostenlosen Versand zu erhalten! 
              <a href="shop/index.html" class="text-blue-600 hover:underline font-medium">Weiter einkaufen</a>`;
          } else {
            $banner.innerHTML = `<span class="font-semibold text-green-700"></span>`;
          }
        }

        function rowTemplate(it, index) {
          const priceEach = parsePriceToNumber(it.price);
          const qty = Math.max(0, Number(it.quantity) || 0);
          const lineTotal = priceEach * qty;
          const img = it.image || it.img || 'placeholder_light_gray_block.png';
          const name = it.name || it.title || 'Produkt';
          const variant = it.variant || it.option || '';
          // desktop 3-col; mobile stacked
          return `
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center py-4 border-b border-gray-200" data-index="${index}">
            <!-- Product details -->
            <div class="flex items-center md:items-start gap-4">
              <img src="${img}" alt="${name}" class="w-20 h-20 md:w-24 md:h-24 object-contain bg-white border border-gray-200 p-2 rounded">
              <div>
                <p class="font-medium text-gray-900">${name}</p>
                <p class="text-sm text-gray-600">${fmtCHF(priceEach)}</p>
                ${variant ? `<p class="text-sm text-gray-500">Variante: ${variant}</p>` : ``}
              </div>
            </div>

            <!-- Quantity controls -->
            <div class="flex justify-start md:justify-center items-center">
              <div class="inline-flex border border-gray-300 rounded-md overflow-hidden">
                <button class="px-3 py-1 text-gray-600 hover:bg-gray-100 focus:outline-none" data-action="dec" aria-label="Menge verringern">−</button>
                <input type="text" value="${qty}" readonly class="w-12 text-center border-l border-r border-gray-300 py-1 focus:outline-none" />
                <button class="px-3 py-1 text-gray-600 hover:bg-gray-100 focus:outline-none" data-action="inc" aria-label="Menge erhöhen">+</button>
              </div>
            </div>

            <!-- Price and remove -->
            <div class="flex justify-between md:justify-end items-center">
              <span class="font-medium text-gray-900">${fmtCHF(lineTotal)}</span>
              <button class="ml-4 text-red-500 hover:text-red-700" aria-label="Entfernen" data-action="remove">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5"><path fill="currentColor" d="M18.3 5.71a1 1 0 00-1.42 0L12 10.59 7.12 5.71A1 1 0 005.7 7.13L10.59 12l-4.9 4.88a1 1 0 101.42 1.42L12 13.41l4.88 4.89a1 1 0 001.42-1.42L13.41 12l4.89-4.88a1 1 0 000-1.41z"/></svg>
              </button>
            </div>
          </div>`;
        }

        function renderPage() {
          const { items } = readCart();
          const qty = totalQty(items);
          const sub = subtotalCHF(items);
          const tax = sub * VAT_RATE;
          const total = sub + tax;

          updateHeaderBubbles(qty);
          renderBanner(sub);

          // Update price breakdown
          $subtotal.textContent = fmtCHF(sub);
          $tax.textContent = fmtCHF(tax);
          $taxRate.textContent = `(${(VAT_RATE * 100).toFixed(1)}%)`;
          $totalWithTax.textContent = fmtCHF(total);

          if (!items.length) {
            $rows.innerHTML = '';
            $emptyPage.classList.remove('hidden');
            return;
          }
          $emptyPage.classList.add('hidden');
          $rows.innerHTML = items.map((it, i) => rowTemplate(it, i)).join('');
        }

        // ---- events ----
        $rows.addEventListener('click', (e) => {
          const btn = e.target.closest('button,[data-action]');
          if (!btn) return;
          const action = btn.getAttribute('data-action');
          const row = btn.closest('[data-index]');
          if (!row) return;
          const index = Number(row.getAttribute('data-index'));
          const state = readCart();
          const items = state.items.slice();
          const item = items[index];
          if (!item) return;

          if (action === 'inc') item.quantity = (Number(item.quantity) || 0) + 1;
          if (action === 'dec') item.quantity = Math.max(0, (Number(item.quantity) || 0) - 1);
          if (action === 'remove') items.splice(index, 1);

          // remove if zero quantity
          if (action !== 'remove' && Number(item.quantity) === 0) {
            items.splice(index, 1);
          }

          writeCart(items);
          renderPage();
        });

        // minimal sidebar open/close (if not already handled by site scripts)
        const openBtns = [document.getElementById('cart-btn-mobile'), document.getElementById('cart-btn-desktop')].filter(Boolean);
        const closeBtn = document.getElementById('close-cart');
        const overlay = document.getElementById('cart-overlay');
        const sidebar = document.getElementById('cart-sidebar');

        function openSidebar() {
          overlay && overlay.classList.remove('hidden');
          sidebar && sidebar.classList.remove('translate-x-full');
        }
        function closeSidebar() {
          overlay && overlay.classList.add('hidden');
          sidebar && sidebar.classList.add('translate-x-full');
        }
        openBtns.forEach(b => b && b.addEventListener('click', openSidebar));
        overlay && overlay.addEventListener('click', closeSidebar);
        closeBtn && closeBtn.addEventListener('click', closeSidebar);

        // boot
        document.addEventListener('DOMContentLoaded', renderPage);
        // also render immediately in case DOMContentLoaded already fired
        if (document.readyState !== 'loading') renderPage();
      })();

    // Disable cart icon interactions on the cart page itself. When the user is
    // already viewing the cart (cart.html), the cart toggle buttons (desktop
    // and mobile) should be inert. We explicitly remove any existing click
    // handlers and block pointer events to prevent the off‑canvas cart from
    // opening again.
    (function disableCartButtonsOnCartPage() {
      // Only disable the cart buttons if the cart content section (#warenkorb)
      // exists on the page. This avoids disabling the icon on other pages.
      if (document.getElementById('warenkorb')) {
        var selectors = ['#cart-btn-desktop', '#cart-btn-mobile'];
        selectors.forEach(function(sel) {
          var btn = document.querySelector(sel);
          if (!btn) return;
          // Remove existing click handlers by cloning the node without events
          var clone = btn.cloneNode(true);
          btn.parentNode.replaceChild(clone, btn);
          // Disable pointer events so it does not appear clickable
          clone.style.pointerEvents = 'none';
          clone.style.cursor = 'default';
        });
      }
    })();
    </script>
  </body>
</html>