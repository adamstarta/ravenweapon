{% sw_extends '@Storefront/storefront/page/account/_page.html.twig' %}

{% block page_account_main_content %}
<div style="padding: 2rem; background: linear-gradient(180deg, #FDFCF9 0%, #F5F3EE 100%); min-height: 400px; font-family: Inter, sans-serif;">

    {% if page.deepLinkCode and page.orders.elements|length > 0 %}
    {# DETAIL VIEW #}
    {% set order = page.orders.elements|first %}

    <a href="{{ path('frontend.account.order.page') }}" style="display: inline-flex; align-items: center; gap: 0.5rem; color: #6b7280; text-decoration: none; margin-bottom: 1.5rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
        Zurück zu Bestellungen
    </a>

    <div style="margin-bottom: 2rem;">
        <h1 style="font-family: Chakra Petch, sans-serif; font-size: 1.75rem; font-weight: 700; color: #1A1A1A; margin: 0 0 0.5rem 0;">Bestellung #{{ order.orderNumber }}</h1>
        <p style="color: #6b7280; margin: 0 0 0.5rem 0;">{{ order.orderDateTime|date('d.m.Y H:i') }}</p>
        <span style="font-size: 0.6875rem; font-weight: 700; padding: 0.375rem 0.75rem; border-radius: 20px; text-transform: uppercase; background: rgba(59, 130, 246, 0.15); color: #2563EB;">{{ order.stateMachineState.translated.name|default('Unbekannt') }}</span>
    </div>

    <div style="background: #fff; border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.06);">
        <h2 style="font-family: Chakra Petch, sans-serif; font-size: 1rem; font-weight: 600; color: #1A1A1A; margin: 0 0 1rem 0; text-transform: uppercase;">Bestellte Artikel</h2>
        {% for lineItem in order.lineItems %}
        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid #f3f4f6;">
            <div style="width: 64px; height: 64px; border-radius: 10px; overflow: hidden; background: #f3f4f6;">
                {% if lineItem.cover %}
                <img src="{{ lineItem.cover.url }}" alt="{{ lineItem.label }}" style="width: 100%; height: 100%; object-fit: cover;">
                {% endif %}
            </div>
            <div style="flex: 1;">
                <p style="font-weight: 600; color: #1A1A1A; margin: 0 0 0.25rem 0;">{{ lineItem.label }}</p>
                <p style="font-size: 0.75rem; color: #6b7280; margin: 0;">Menge: {{ lineItem.quantity }}</p>
            </div>
            <div style="text-align: right;">
                <span style="display: block; font-size: 0.75rem; color: #9ca3af;">CHF {{ lineItem.unitPrice|number_format(2, '.', ' ') }}</span>
                <span style="font-weight: 700; color: #1A1A1A;">CHF {{ lineItem.totalPrice|number_format(2, '.', ' ') }}</span>
            </div>
        </div>
        {% endfor %}
    </div>

    <div style="background: #fff; border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.06);">
        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; color: #374151;">
            <span>Zwischensumme</span>
            <span>CHF {{ order.price.positionPrice|number_format(2, '.', ' ') }}</span>
        </div>
        {% for delivery in order.deliveries %}
        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; color: #374151;">
            <span>Versand</span>
            <span>CHF {{ delivery.shippingCosts.totalPrice|number_format(2, '.', ' ') }}</span>
        </div>
        {% endfor %}
        <div style="display: flex; justify-content: space-between; padding-top: 1rem; margin-top: 0.5rem; border-top: 2px solid #e5e7eb; font-weight: 700; color: #1A1A1A; font-size: 1.125rem;">
            <span>Gesamtsumme</span>
            <span>CHF {{ order.amountTotal|number_format(2, '.', ' ') }}</span>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
        <div style="background: #fff; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.06);">
            <h3 style="font-family: Chakra Petch, sans-serif; font-size: 0.875rem; font-weight: 600; color: #1A1A1A; margin: 0 0 1rem 0; text-transform: uppercase; padding-bottom: 0.75rem; border-bottom: 1px solid #f3f4f6;">Rechnungsadresse</h3>
            <p style="margin: 0.25rem 0; font-weight: 600; color: #1A1A1A;">{{ order.billingAddress.firstName }} {{ order.billingAddress.lastName }}</p>
            <p style="margin: 0.25rem 0; color: #374151;">{{ order.billingAddress.street }}</p>
            <p style="margin: 0.25rem 0; color: #374151;">{{ order.billingAddress.zipcode }} {{ order.billingAddress.city }}</p>
            <p style="margin: 0.25rem 0; color: #374151;">{{ order.billingAddress.country.translated.name }}</p>
        </div>
        {% for delivery in order.deliveries %}
        <div style="background: #fff; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.06);">
            <h3 style="font-family: Chakra Petch, sans-serif; font-size: 0.875rem; font-weight: 600; color: #1A1A1A; margin: 0 0 1rem 0; text-transform: uppercase; padding-bottom: 0.75rem; border-bottom: 1px solid #f3f4f6;">Lieferadresse</h3>
            <p style="margin: 0.25rem 0; font-weight: 600; color: #1A1A1A;">{{ delivery.shippingOrderAddress.firstName }} {{ delivery.shippingOrderAddress.lastName }}</p>
            <p style="margin: 0.25rem 0; color: #374151;">{{ delivery.shippingOrderAddress.street }}</p>
            <p style="margin: 0.25rem 0; color: #374151;">{{ delivery.shippingOrderAddress.zipcode }} {{ delivery.shippingOrderAddress.city }}</p>
            <p style="margin: 0.25rem 0; color: #374151;">{{ delivery.shippingOrderAddress.country.translated.name }}</p>
        </div>
        {% endfor %}
    </div>

    {% else %}
    {# LIST VIEW #}
    <div style="margin-bottom: 2rem;">
        <h1 style="font-family: Chakra Petch, sans-serif; font-size: 1.75rem; font-weight: 700; color: #1A1A1A; margin: 0 0 0.5rem 0; text-transform: uppercase;">Meine Bestellungen</h1>
        <p style="color: #6b7280; margin: 0;">Übersicht aller Ihrer Bestellungen</p>
    </div>

    {% if page.orders.elements|length > 0 %}
    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
        {% for order in page.orders %}
        <div style="background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.06);">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; border-bottom: 1px solid #f3f4f6;">
                <div>
                    <span style="display: block; font-family: Chakra Petch, sans-serif; font-weight: 600; color: #1A1A1A;">#{{ order.orderNumber }}</span>
                    <span style="font-size: 0.875rem; color: #6b7280;">{{ order.orderDateTime|date('d.m.Y H:i') }}</span>
                </div>
                <span style="font-size: 0.6875rem; font-weight: 700; padding: 0.375rem 0.75rem; border-radius: 20px; text-transform: uppercase; background: rgba(59, 130, 246, 0.15); color: #2563EB;">{{ order.stateMachineState.translated.name|default('Unbekannt') }}</span>
            </div>

            <div style="padding: 1rem 1.25rem;">
                {% for lineItem in order.lineItems|slice(0, 3) %}
                <div style="display: flex; align-items: center; gap: 1rem; padding: 0.5rem 0;">
                    <div style="width: 48px; height: 48px; border-radius: 8px; overflow: hidden; background: #f3f4f6;">
                        {% if lineItem.cover %}
                        <img src="{{ lineItem.cover.url }}" alt="{{ lineItem.label }}" style="width: 100%; height: 100%; object-fit: cover;">
                        {% endif %}
                    </div>
                    <span style="flex: 1; font-size: 0.875rem; color: #1A1A1A;">{{ lineItem.label }}</span>
                    <span style="font-weight: 600; color: #1A1A1A;">CHF {{ lineItem.totalPrice|number_format(2, '.', ' ') }}</span>
                </div>
                {% endfor %}
                {% if order.lineItems|length > 3 %}
                <p style="text-align: center; color: #9ca3af; font-size: 0.8125rem; font-style: italic; margin: 0.5rem 0 0 0;">+{{ order.lineItems|length - 3 }} weitere Artikel</p>
                {% endif %}
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; background: #f9fafb; border-top: 1px solid #f3f4f6;">
                <div>
                    <span style="display: block; font-size: 0.75rem; color: #6b7280; text-transform: uppercase;">Gesamt</span>
                    <span style="font-family: Chakra Petch, sans-serif; font-size: 1.25rem; font-weight: 700; color: #1A1A1A;">CHF {{ order.amountTotal|number_format(2, '.', ' ') }}</span>
                </div>
                <a href="{{ path('frontend.account.order.single.page', { deepLinkCode: order.deepLinkCode }) }}" style="display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 600; color: #B8922E; text-decoration: none;">
                    Details anzeigen
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 4rem 2rem; background: #fff; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.06);">
        <h3 style="font-family: Chakra Petch, sans-serif; font-size: 1.5rem; color: #1A1A1A; margin: 0 0 0.5rem 0;">Noch keine Bestellungen</h3>
        <p style="color: #6b7280; margin: 0 0 2rem 0;">Sobald Sie eine Bestellung aufgeben, wird sie hier angezeigt.</p>
        <a href="{{ path('frontend.home.page') }}" style="display: inline-block; padding: 0.875rem 2rem; background: linear-gradient(135deg, #D4A847 0%, #E8C76B 100%); border: 2px solid #B8922E; border-radius: 12px; color: #1A1A1A; font-weight: 700; text-decoration: none;">Jetzt einkaufen</a>
    </div>
    {% endif %}
    {% endif %}
</div>
{% endblock %}
